<!doctype html><html lang=ru dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>Journey to a Federated GraphQL | ĞÑ€Ñ‚Ñ‘Ğ¼ ĞšÑƒÑ€Ğ°Ğ¿Ğ¾Ğ²</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content="https://kurapov.ee/blog/tech/Journey to a Federated GraphQL"><meta data-rh=true property=og:locale content=ru><meta data-rh=true name=docusaurus_locale content=ru><meta data-rh=true name=docusaurus_tag content=default><meta data-rh=true name=docsearch:language content=ru><meta data-rh=true name=docsearch:docusaurus_tag content=default><meta data-rh=true property=og:title content="Journey to a Federated GraphQL | ĞÑ€Ñ‚Ñ‘Ğ¼ ĞšÑƒÑ€Ğ°Ğ¿Ğ¾Ğ²"><meta data-rh=true name=description content="Original post at medium"><meta data-rh=true property=og:description content="Original post at medium"><meta data-rh=true property=og:image content=https://miro.medium.com/max/1400/1*6ADAF1r2LFunXgdklnMRzw.png><meta data-rh=true name=twitter:image content=https://miro.medium.com/max/1400/1*6ADAF1r2LFunXgdklnMRzw.png><meta data-rh=true property=og:type content=article><meta data-rh=true property=article:published_time content=2020-09-09T16:34:00.000Z><link data-rh=true rel=icon href=/img/favicon/favicon.ico><link data-rh=true rel=canonical href="https://kurapov.ee/blog/tech/Journey to a Federated GraphQL"><link data-rh=true rel=alternate href="https://kurapov.ee/blog/tech/Journey to a Federated GraphQL" hreflang=ru><link data-rh=true rel=alternate href="https://kurapov.ee/blog/tech/Journey to a Federated GraphQL" hreflang=x-default><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://kurapov.ee/blog/tech/Journey to a Federated GraphQL","@type":"BlogPosting","author":[],"datePublished":"2020-09-09T16:34:00.000Z","description":"Original post at medium","headline":"Journey to a Federated GraphQL","image":{"@id":"https://miro.medium.com/max/1400/1*6ADAF1r2LFunXgdklnMRzw.png","@type":"ImageObject","caption":"title image for the blog post: Journey to a Federated GraphQL","contentUrl":"https://miro.medium.com/max/1400/1*6ADAF1r2LFunXgdklnMRzw.png","url":"https://miro.medium.com/max/1400/1*6ADAF1r2LFunXgdklnMRzw.png"},"isPartOf":{"@id":"https://kurapov.ee/blog","@type":"Blog","name":"Blog"},"keywords":[],"mainEntityOfPage":"https://kurapov.ee/blog/tech/Journey to a Federated GraphQL","name":"Journey to a Federated GraphQL","url":"https://kurapov.ee/blog/tech/Journey to a Federated GraphQL"}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="ĞÑ€Ñ‚Ñ‘Ğ¼ ĞšÑƒÑ€Ğ°Ğ¿Ğ¾Ğ² RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="ĞÑ€Ñ‚Ñ‘Ğ¼ ĞšÑƒÑ€Ğ°Ğ¿Ğ¾Ğ² Atom Feed"><link rel=stylesheet href=/assets/css/styles.d5d08b3f.css><script src=/assets/js/runtime~main.9418d692.js defer></script><script src=/assets/js/main.6b58b616.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğº Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¼Ñƒ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ¼Ñƒ"><a class=skipToContent_aCxL href=#__docusaurus_skipToContent_fallback>ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğº Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¼Ñƒ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ¼Ñƒ</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½ÑƒÑ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/artjom.jpg alt="Artjom Kurapov" class="themedComponent_cfDz themedComponent--light_Kj2W"><img src=/img/artjom.jpg alt="Artjom Kurapov" class="themedComponent_cfDz themedComponent--dark__Nfe"></div><b class="navbar__title text--truncate">ĞÑ€Ñ‚Ñ‘Ğ¼ ĞšÑƒÑ€Ğ°Ğ¿Ğ¾Ğ²</b></a><a class="navbar__item navbar__link" href="/docs/ĞĞ± Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğµ">ĞĞ± Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğµ</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/blog>Ğ‘Ğ»Ğ¾Ğ³</a></div><div class="navbar__items navbar__items--right"><a href=https://github.com/tot-ra/kurapov.ee target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="toggle_LxwK colorModeToggle_c2rS"><button class="clean-btn toggleButton_gSiH toggleButtonDisabled_GY0v" type=button disabled title="ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ‚ĞµĞ¼Ğ½Ñ‹Ğ¼ Ğ¸ ÑĞ²ĞµÑ‚Ğ»Ñ‹Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ¾Ğ¼ (ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ¡Ğ²ĞµÑ‚Ğ»Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼)" aria-label="ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ‚ĞµĞ¼Ğ½Ñ‹Ğ¼ Ğ¸ ÑĞ²ĞµÑ‚Ğ»Ñ‹Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ¾Ğ¼ (ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ¡Ğ²ĞµÑ‚Ğ»Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼)" aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_WH3Q><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_OWtW><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_vXry></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_jkFy"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_aM6_ thin-scrollbar" aria-label="ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¼ Ğ¿Ğ¾ÑÑ‚Ğ°Ğ¼ Ğ² Ğ±Ğ»Ğ¾Ğ³Ğµ"><div class="sidebarItemTitle_Dvxs margin-bottom--md">ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸</div><div role=group><h3 class=yearGroupHeading_ZKt1>2025</h3><ul class="sidebarItemList_X9hj clean-list"><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/Ğ²ĞµÑ€Ğ°/ĞÑ‚ Ñ‡ĞµĞ³Ğ¾ ÑĞ¿Ğ°ÑĞ°ĞµÑ‚ Ğ¥Ñ€Ğ¸ÑÑ‚Ğ¾Ñ">Ğ²ĞµÑ€Ğ°/ĞÑ‚ Ñ‡ĞµĞ³Ğ¾ ÑĞ¿Ğ°ÑĞ°ĞµÑ‚ Ğ¥Ñ€Ğ¸ÑÑ‚Ğ¾Ñ</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2025/05/07/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ/ AWS Gen AI meetup"> AWS Gen AI meetup</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2025/04/29/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ/ AGI - Beyond the Hype Before the Storm">AGI: Beyond the Hype, Before the Storm</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2025/04/28/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ/ Decentralized AI event"> Decentralized AI event</a></ul></div><div role=group><h3 class=yearGroupHeading_ZKt1>2024</h3><ul class="sidebarItemList_X9hj clean-list"><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2024/12/13/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ/ Tallinn AI meetup"> Tallinn AI meetup</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2024/11/26/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ/ AI meetup notes"> AI meetup notes</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href=/blog/2024/11/14/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ/AI-ED-Webinar>Andmete ja tehisintellekti olulisusest personaliseerituma Ãµppe poole liikumisel by Innar Liiv</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/ĞºĞ¸Ğ½Ğ¾/The Wild Robot">ĞºĞ¸Ğ½Ğ¾/The Wild Robot</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href='/blog/ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ/Product team models - project based, "feature factory" and product operating model'>Product team models - project based, feature factory and product operating model</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/tech/devices/ĞœĞ¾Ñ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ñ Ñ‡Ğ°ÑĞ¾Ğ² Ğ² 2024">ĞœĞ¾Ñ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ñ Ñ‡Ğ°ÑĞ¾Ğ² Ğ² 2024</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/tech/soft/ĞšĞ°Ğº Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ ÑĞºÑ€Ğ°Ğ½ Ñ ĞºÑ€ÑƒĞ³Ğ»Ğ¾Ğ¹ ĞºĞ°Ğ¼ĞµÑ€Ğ¾Ğ¹">ĞšĞ°Ğº Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ ÑĞºÑ€Ğ°Ğ½ Ñ ĞºÑ€ÑƒĞ³Ğ»Ğ¾Ğ¹ ĞºĞ°Ğ¼ĞµÑ€Ğ¾Ğ¹</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href=/blog/2024/10/18/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ/AsuurKeraamika>Asuur Keraamika</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href=/blog/tech/backend/gpu/CUDA>CUDA</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2024/10/12/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ/Katana meetup">Katana meetup</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2024/10/04/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ/Pipedrive meetup">Pipedrive meetup</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2024/10/01/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ/Digit 2024 Tartu">Digit Tartu conference 2024</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2024/09/25/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ/TallinnJS meetup">Tallinn JS meetup</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2024/05/24/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ/Latitude 59">Latitude 59</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ/hiring/Homework sandboxes">Sandboxes for homework assignments</a></ul></div><div role=group><h3 class=yearGroupHeading_ZKt1>2022</h3><ul class="sidebarItemList_X9hj clean-list"><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/Ğ¿ÑĞ¸Ñ…Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ/ĞĞ± ÑÑ‚Ğ¸ĞºĞµ Ğ¿Ñ‡ĞµĞ»Ğ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ°">ĞĞ± ÑÑ‚Ğ¸ĞºĞµ Ğ¿Ñ‡ĞµĞ»Ğ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ°</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_Y5lg>Journey to a Federated GraphQL</h1><div class="container__LhH margin-vert--md"><time datetime=2020-09-09T16:34:00.000Z>9 ÑĞµĞ½Ñ‚ÑĞ±Ñ€Ñ 2020 Ğ³.</time> Â· <!-- -->15 Ğ¼Ğ¸Ğ½. Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ</div></header><div id=__blog-post-container class=markdown><p>Original post <a href=https://medium.com/pipedrive-engineering/journey-to-federated-graphql-2a6f2eecc6a4 target=_blank rel="noopener noreferrer">at medium</a></p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/1400/1*6ADAF1r2LFunXgdklnMRzw.png alt=https://miro.medium.com/max/1400/1*6ADAF1r2LFunXgdklnMRzw.png class=img_sJtY></p>
<p>Image taken from <a href=http://dgraph.io target=_blank rel="noopener noreferrer">dgraph.io</a></p>
<p>Engineers tend to love good stories, so hopefully our 5-year journey of moving towards API composition withÂ <a href=https://graphql.org/ target=_blank rel="noopener noreferrer">GraphQL</a>Â now in production (serving at peak 110 requests per second at 100ms latency) provides a good story.</p>
<p>[If youâ€™re in a hurry, scroll down toÂ <em>Lessons learned</em>Â and check out the open-sourcedÂ <a href=https://github.com/pipedrive/graphql-schema-registry target=_blank rel="noopener noreferrer">graphql-schema-registry</a>.]</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/1400/1*d32xg4FUICDlOm9q0PCLkw.png alt=https://miro.medium.com/max/1400/1*d32xg4FUICDlOm9q0PCLkw.png class=img_sJtY></p>
<p>schema registry with someÂ <a href=https://github.com/jeffwillette/graphql-go-pets-example target=_blank rel="noopener noreferrer">example schema</a></p>
<h1><strong>Our Requirement</strong></h1>
<p>For years, Pipedrive (which hit 10 years near the beginning of 2020) has had aÂ <a href=https://developers.pipedrive.com/docs/api/v1/ target=_blank rel="noopener noreferrer">public REST API</a>, as well as hidden, undocumented endpoints for our webapp â€” one of which isÂ <em>/users/self,</em>Â that was initially for loading user information but over time became a page-load API, composed of 30 different entity types. It originated in our PHP monolith which by nature is synced. WeÂ <a href=https://medium.com/pipedrive-engineering/how-two-developers-accelerated-php-monolith-in-pipedrive-df8a18bc2d8a target=_blank rel="noopener noreferrer">tried to split it</a>Â into parallel threads but that didnâ€™t work out so well.</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/1400/1*pqnU6EvMYnIQmVnnt5V1mA.png alt=https://miro.medium.com/max/1400/1*pqnU6EvMYnIQmVnnt5V1mA.png class=img_sJtY></p>
<p>/users/self latency distribution currently for the remaining traffic</p>
<p>From a maintenance point of view, with every new change, it became messier as nobody wanted to own this enormous endpoint.</p>
<h1><strong>Direct DB Access PoC</strong></h1>
<p>Let's go back in time to when our devs experimented with graphql.</p>
<p>About 3â€“4 years ago in theÂ <a href=https://marketplace.pipedrive.com/ target=_blank rel="noopener noreferrer">marketplace</a>Â team, I began hearing new terms like â€œ<a href=https://elixir-lang.org/ target=_blank rel="noopener noreferrer">elixir</a>â€ and â€œgraphqlâ€ fromÂ <a href=https://twitter.com/bashmach target=_blank rel="noopener noreferrer">Pavel</a>, our fullstack engineer. He was involved in a proof-of-concept project which directly accessed MySQL and exposed theÂ <em>/graphql</em>Â endpoint for querying core Pipedrive entities.</p>
<p>It worked fine in dev, but it wasnâ€™t scalable because our backend was not only CRUD and nobody wanted to rewrite the monolith.</p>
<h1><strong>Stitching PoC</strong></h1>
<p>Fast forward to 2019 when I saw another internal PoC by a colleague that used GraphQL schema stitching withÂ <a href=https://github.com/graphql-compose/graphql-compose target=_blank rel="noopener noreferrer">graphql-compose</a>Â and makes requests to our REST API. As you can imagine, this was a major improvement since we wouldnâ€™t need to re-implement all of the business logic and it was just a wrapper.</p>
<p>The downsides in this PoC were:</p>
<ul>
<li>
<p><strong>Performance</strong></p>
<p>. It didnâ€™t have</p>
<p><a href=https://github.com/graphql/dataloader target=_blank rel="noopener noreferrer">dataloader</a></p>
<p>, so it had a potential N+1 API call problem. It didnâ€™t limit query complexity and it didnâ€™t have any intermediate caching. On average, the latency was higher than with the monolith.</p>
</li>
<li>
<p><strong>Schema management.</strong>Â With schema stitching, we need to define a schema in the single repo, separate from an actual service that serves data. This complicates deployment, as we would need intermediate backward-compatible deployments to avoid crashes in case service changes.</p>
</li>
</ul>
<h1><strong>Preparation</strong></h1>
<p>In October 2019, I started to prepare for the mission that would move the previous PoC into production, but with a new Apollo federation thatÂ <a href=https://www.apollographql.com/blog/apollo-federation-f260cf525d21/ target=_blank rel="noopener noreferrer">came out</a>Â the same year. This would also land into a core team that would maintain the service through the long-term.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=gathering-developer-expectations><strong>Gathering developer expectations</strong><a href=#gathering-developer-expectations class=hash-link aria-label="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° gathering-developer-expectations" title="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° gathering-developer-expectations">â€‹</a></h2>
<p>Internally, some developers were skeptical and suggested building an in-house API composition by stitching REST API URLs and their payloads into a single POST request and relying on an internal gateway to split requests on the backend.</p>
<p>Some saw graphql as still too raw to adopt in production & keep a status-quo. Some suggested exploring alternatives, like Protobuf orÂ <a href=https://thrift.apache.org/ target=_blank rel="noopener noreferrer">Thrift</a>, and using transport conventions likeÂ <a href=https://grpc.io/ target=_blank rel="noopener noreferrer">GRPC</a>,Â <a href=https://www.odata.org/ target=_blank rel="noopener noreferrer">OData</a>.</p>
<p>Conversely, some teams went full throttle and already had graphql in production for individual services (insights, teams), but couldnâ€™t reuse other schemas (like User entity). Some (<a href=https://www.pipedrive.com/en/jobs/czech-republic target=_blank rel="noopener noreferrer">leads</a>) used a typescript +Â <a href=https://relay.dev/ target=_blank rel="noopener noreferrer">relay</a>Â which still needed to figure outÂ <a href=https://github.com/apollographql/apollo-server/issues/3159 target=_blank rel="noopener noreferrer">how to federate</a>.</p>
<p>Local conference talk about a similar topic (VP of Tech @Â <a href=https://medium.com/@MyMonese target=_blank rel="noopener noreferrer">Monese</a>)</p>
<p>Researching new tech was exciting<!-- -->:Strict<!-- -->, self-describing API for frontend developers? Global entity declaration and ownership that forces the reduction of duplication and increases transparency? A gateway that could automatically join data from different services without over-fetching? Wow.</p>
<p>I knew that we needed schema management as a service to not rely on a hard-coded one and have visibility on whatâ€™s happening. Something likeÂ <a href=https://docs.confluent.io/current/schema-registry/index.html target=_blank rel="noopener noreferrer">Confluentâ€™s schema-registry</a>Â orÂ <a href=https://bitbucket.org/atlassian/graphql-braid/src/master/ target=_blank rel="noopener noreferrer">Atlassianâ€™s Braid</a>, but not Kafka-specific or written in Java, which we didnâ€™t want to maintain.</p>
<h1><strong>The plan</strong></h1>
<p>I pitched an engineering mission that focused on 3 goals:</p>
<ul>
<li>Reducing initial page load time (pipeline view) by 15%. Achievable by joining some REST API calls into a single /graphql request</li>
<li>Reducing API traffic by 30%. Achievable by moving deal loading for the pipeline view to graphql and requesting fewer properties.</li>
<li>Using strict schema in API (for the frontend to write lessÂ <a href=https://en.wikipedia.org/wiki/Defensive_programming target=_blank rel="noopener noreferrer">defensive code</a>)</li>
</ul>
<p>I was lucky to getÂ <a href=https://github.com/pipedrive/graphql-schema-registry#honorable-mentions target=_blank rel="noopener noreferrer">3 awesome experienced developers</a>Â to join the mission, including a PoC author.</p>
<p>Multiple REST API calls from webapp done at different time</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/5004/1*jmyHq5UWstzZeCuXSPYHIw.png alt=https://miro.medium.com/max/5004/1*jmyHq5UWstzZeCuXSPYHIw.png class=img_sJtY></p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/5000/1*_L6W6bxg5jt4oC_Yd6jkAw.png alt=https://miro.medium.com/max/5000/1*_L6W6bxg5jt4oC_Yd6jkAw.png class=img_sJtY></p>
<p>The original plan for the services looked like this:</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/1400/1*hZPmw66Kk3e9TtYj-FWNEg.png alt=https://miro.medium.com/max/1400/1*hZPmw66Kk3e9TtYj-FWNEg.png class=img_sJtY></p>
<p>Services we would need to work on</p>
<p>The schema-registry here would be a generic service that could store any type of schema you throw at it as an input (<a href=https://editor.swagger.io/ target=_blank rel="noopener noreferrer">swagger</a>, typescript, graphql, avro, proto). It would also be smart enough to convert an entity to whatever format you want for the output. The gateway would poll schema and call services that own it. Frontend components would need to download schema and use it for making queries.</p>
<p>In reality however, we implemented only graphql because federation only need this and we ran out of time pretty quickly.</p>
<h1><strong>Results</strong></h1>
<p>The main goal of replacing messyÂ <em>/users/self</em>Â endpoint in the webapp was done within the first 2 weeks of the mission ğŸ˜³ (yay!). Polishing it so that itâ€™s performant and reliable, took most of the mission time though.</p>
<p>By the end of the mission (in February 2020), weÂ <em>did</em>Â achieveÂ <strong>13%</strong>Â initial page load time reduction andÂ <strong>25%</strong>Â on page reload (due to introduced caching) based on the syntheticÂ <a href=https://www.datadoghq.com/ target=_blank rel="noopener noreferrer">Datadog</a>Â test that we used.</p>
<p>We did not reach the goal of traffic volume reduction, because we didnâ€™t reach the refactoringÂ <em>pipeline</em>Â view in webapp â€” we still use REST there.</p>
<p>To increase adoption we added internal tooling to ease federation process and recorded onboarding videos for teams to understand how it works now. After the mission ended, IOS and Android clients also migrated to graphql and the teams gave positive feedback.</p>
<h1><strong>Lessons learned</strong></h1>
<p>Looking back at the mission log that I kept for all of the 60 days, I can outline the biggest issues so that you donâ€™t make the same mistakes</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=manage-your-schema><strong>Manage your schema</strong><a href=#manage-your-schema class=hash-link aria-label="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° manage-your-schema" title="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° manage-your-schema">â€‹</a></h2>
<blockquote>
<p>Could we have built this ourselves? Maybe, but it wouldnâ€™t be as polished.Mark Stuart, Paypal Engineering</p>
</blockquote>
<p>Through the first couple of days, I triedÂ <a href=https://studio.apollographql.com/ target=_blank rel="noopener noreferrer">Apollo studio</a>Â & itsÂ <a href=https://www.apollographql.com/docs/studio/schema-checks/#the-check-process target=_blank rel="noopener noreferrer">tooling</a>Â for CLI to validate schema. The service is excellent and works out-of-the-box with minimal gateway configuration.</p>
<p>Our internal tools to see schema diffs and validate pushed schema from the terminal, similar to Apolloâ€™s tooling</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/2612/1*peOiXrxaxYTeJ0kAjXOqnA.png alt=https://miro.medium.com/max/2612/1*peOiXrxaxYTeJ0kAjXOqnA.png class=img_sJtY></p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/3700/1*0PkQISCe0ux2nG6c6l5wXg.png alt=https://miro.medium.com/max/3700/1*0PkQISCe0ux2nG6c6l5wXg.png class=img_sJtY></p>
<p>As well as it works, I still felt that tying core backend traffic to an external SaaS is too risky for business continuity, regardless of its great features or pricing plans. This is why we wrote a service of our own, with basic functionality â€” now itâ€™s an open-sourceÂ <a href=https://github.com/pipedrive/graphql-schema-registry target=_blank rel="noopener noreferrer">graphql-schema-registry</a>.</p>
<p>The second reason to have in-house schema-registry was to follow Pipedriveâ€™sÂ <a href=https://medium.com/pipedrive-engineering/tanker-the-story-of-multi-dc-customer-data-migration-framework-ad842c2c6b9c target=_blank rel="noopener noreferrer">distributed datacenter model</a>. We donâ€™t rely on centralized infrastructure, every datacenter is self-sufficient. This gives us higher reliability as well as a potential advantage in case we need to open a new DC in places like China, Russia, Iran, or Mars ğŸš€</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=version-your-schema><strong>Version your schema</strong><a href=#version-your-schema class=hash-link aria-label="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° version-your-schema" title="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° version-your-schema">â€‹</a></h2>
<p>Federated schema and graphql gateway are very fragile. If you have type name collision or invalid reference in one of the services and serve it to the gateway, it wonâ€™t like it.</p>
<p>By default, a gatewayâ€™s behavior is toÂ <a href=https://www.apollographql.com/docs/apollo-server/federation/introduction/#gateway-example target=_blank rel="noopener noreferrer">poll services for their schemas</a>Â so it's easy for one service to crash the traffic. Apollo studio solves it by validating schema on-push and rejecting registration if it causes possible conflict.</p>
<p>The validation concept is the right way to go, but the implementation also means that Apollo studio is aÂ <strong>stateful</strong>Â service that holdsÂ <strong>current</strong>Â valid schema. It makes the schemaÂ <a href=https://www.apollographql.com/docs/studio/schema/schema-reporting-protocol/#protocol-sequence target=_blank rel="noopener noreferrer">registration protocol</a>Â more complex andÂ <a href=https://www.apollographql.com/docs/studio/schema/schema-reporting/#rolling-deploys-with-schema-reporting target=_blank rel="noopener noreferrer">dependent on time</a>, which can be somewhat hard to debug in case ofÂ <em>rolling deploys</em>.</p>
<p>In contrast, we tied the service version (based onÂ <strong>docker image hash</strong>) to its schema. Service registers schema also in runtime, but we do it once, withoutÂ <a href=https://www.apollographql.com/docs/studio/schema/schema-reporting/#rolling-deploys-with-schema-reporting target=_blank rel="noopener noreferrer">constant pushing</a>. The gateway takes federated services from service discovery (<a href=https://www.consul.io/ target=_blank rel="noopener noreferrer">consul</a>) and asks schema-registry toÂ <em>/schema/compose</em>, providing their servicesâ€™Â <strong>versions</strong>.</p>
<p>If schema-registry sees that the provided set of versions is not stable, it falls back to the last registered versions (which are used for schema validation on commit, so should be stable).</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/1400/1*Sw5SVUCfE0pU3eqpcVg7EQ.png alt=https://miro.medium.com/max/1400/1*Sw5SVUCfE0pU3eqpcVg7EQ.png class=img_sJtY></p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/1400/1*ycJcR95HBuDhgkyWkUN2aw.png alt=https://miro.medium.com/max/1400/1*ycJcR95HBuDhgkyWkUN2aw.png class=img_sJtY></p>
<p>Runtime schema registration example using an internal library</p>
<p>Services can serve both REST and Graphql APIs, so we resort to alerts in case schema registration fails, keeping service operational for REST to work.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=defining-schema-based-on-existing-rest-is-not-so-straightforward><strong>Defining schema based on existing REST is not so straightforward</strong><a href=#defining-schema-based-on-existing-rest-is-not-so-straightforward class=hash-link aria-label="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° defining-schema-based-on-existing-rest-is-not-so-straightforward" title="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° defining-schema-based-on-existing-rest-is-not-so-straightforward">â€‹</a></h2>
<p>Since I didnâ€™t know how to convert our REST API to graphql, I triedÂ <a href=https://github.com/IBM/openapi-to-graphql target=_blank rel="noopener noreferrer">openapi-to-graphql</a>, but ourÂ <a href=https://developers.pipedrive.com/docs/api/v1/ target=_blank rel="noopener noreferrer">API reference</a>Â didnâ€™t have sufficiently detailed swagger documentation to cover all inputs/outputs at the time.</p>
<p>Asking each team to define schema would take so much time that we just defined the schema for main entities ourselves ğŸ˜“ based on REST API responses.</p>
<p>Doing this came back to haunt us later, when it turned out that some of the REST API depended on the client that makes requestsÂ <strong>OR</strong>Â had different response format depending on some business logic/state.</p>
<p>For example,Â <strong>custom fields</strong>Â affect API response depending on the customer. If you add a custom field to a deal, it will be served as aÂ <em>hash</em>Â on the same level asÂ <em>deal.pipeline_id</em>. Dynamic schema is not possible with graphql federation, so we had to work-around that by moving custom fields into a separate property.</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/3040/1*wRvmLci_zeX8SI3XLablcA.png alt=https://miro.medium.com/max/3040/1*wRvmLci_zeX8SI3XLablcA.png class=img_sJtY></p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/5452/1*jYUN6yru6BRPltGcZvQzqQ.png alt=https://miro.medium.com/max/5452/1*jYUN6yru6BRPltGcZvQzqQ.png class=img_sJtY></p>
<p>Another long-term issue isÂ <strong>naming conventions</strong>. We wanted to useÂ <em>camelCase</em>, but since most of REST usedÂ <em>snake_case</em>, we ended up with a mix for now.</p>
<p>Current Pipedriveâ€™s federated graph (on the left) with 2 federated microservices (out of 539) and not-yet federated leads (on the right), generated withÂ <a href=https://github.com/APIs-guru/graphql-voyager target=_blank rel="noopener noreferrer">voyager</a></p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/2420/1*4FDJvhR6Z9zQSCF4_lu-Qg.png alt=https://miro.medium.com/max/2420/1*4FDJvhR6Z9zQSCF4_lu-Qg.png class=img_sJtY></p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/3860/1*x2jV67R_69ZYy6y75TsDiA.png alt=https://miro.medium.com/max/3860/1*x2jV67R_69ZYy6y75TsDiA.png class=img_sJtY></p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=cqrs-and-cache><strong>CQRS and cache</strong><a href=#cqrs-and-cache class=hash-link aria-label="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° cqrs-and-cache" title="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° cqrs-and-cache">â€‹</a></h2>
<p>The Pipedrive data model isnâ€™t simple enough to rely only on a TTL-cache.</p>
<p>For example, if a support engineer creates aÂ <em>global message</em>Â about maintenance from our backoffice, he also expects it to be immediately shown to customers. Those global messages can be shown toÂ <em>all customers</em>Â or can affectÂ <em>specific users</em>Â orÂ <em>companies</em>. Breaking such cache needs 3 layers.</p>
<p>To handle php monolith with graphql in async mode, we have created a nodejs service (calledÂ <em>monograph</em>) which caches everything php responded into memcached. This cache has to be cleaned from PHP depending on business-logic making it a bit of an anti-pattern of tightly-coupled cross-service cache.</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/1400/1*MWhY3MEiDCMs2lnpWjyvIQ.png alt=https://miro.medium.com/max/1400/1*MWhY3MEiDCMs2lnpWjyvIQ.png class=img_sJtY></p>
<p>You can see theÂ <a href=https://martinfowler.com/bliki/CQRS.html target=_blank rel="noopener noreferrer">CQRS pattern</a>Â here. Such cache makes it possible to speed-up 80% of requests and get avg latency to the same as php-app, while still having strict schema and no overfetching</p>
<p>Average latency in php-app (left) vs graphql gateway (right) in US region via NewRelic</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/3192/1*-6FCWqp-bdqK64_5wq-wtw.png alt=https://miro.medium.com/max/3192/1*-6FCWqp-bdqK64_5wq-wtw.png class=img_sJtY></p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/3128/1*F6ArQsPeRYYiAeD4zOAOCg.png alt=https://miro.medium.com/max/3128/1*F6ArQsPeRYYiAeD4zOAOCg.png class=img_sJtY></p>
<p>Another complication is theÂ <em>customerâ€™s language</em>. Changing this affects so many different entities â€” from activity types to google map views and to make things worse, the user language is not managed by php-app anymore, its inÂ <em>identity</em>Â service â€” and I didnâ€™t want to couple even more services to a single cache.</p>
<p><em>Identity</em>Â owns user information, so it emits a change event thatÂ <em>monograph</em>Â listens to and clears its caches. ThisÂ <em>means</em>Â that there is some delay (maybe max ~1 sec) between changing language and getting caches cleared, but it's not critical, because a customer wonâ€™t navigate away from a pageÂ <em>so fast</em>Â to notice the old language still in the cache.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=track-performance><strong>Track performance</strong><a href=#track-performance class=hash-link aria-label="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° track-performance" title="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° track-performance">â€‹</a></h2>
<p>Performance was the main goal and to reach that goal we had to master APM and distributed tracing between microservices to see what is the slowest area. We used Datadog during this time and it showed the main issues.</p>
<p>We also used memcached to cache all 30 parallel requests. The problem (shown on this picture) displays that purple requests to memcached for some of the resolvers throttled up to 220ms, whereas the first 20 requests saved data in 10ms. This was because I used the sameÂ <a href=https://github.com/facebook/mcrouter target=_blank rel="noopener noreferrer">mcrouter</a>Â host for all of the requests. Rotating hosts reduced caching write latency to 20 ms max.</p>
<p>To reduce latency due to network traffic, we got data from memcached with a single batch request for different resolvers usingÂ <a href=https://github.com/3rd-Eden/memcached#public-methods target=_blank rel="noopener noreferrer">getMulti</a>Â and a 5 ms debounce.</p>
<p>Issues during mission â€” memcached (left), slow single resolver (right) in Datadog distributed tracing</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/3700/1*ibZbgnevw9dsYg0nVHbo3Q.png alt=https://miro.medium.com/max/3700/1*ibZbgnevw9dsYg0nVHbo3Q.png class=img_sJtY></p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/2388/1*bB4N6SdLy0kAQvRO5o3aAQ.png alt=https://miro.medium.com/max/2388/1*bB4N6SdLy0kAQvRO5o3aAQ.png class=img_sJtY></p>
<p>Notice also the yellow bars on the right â€” thatâ€™s the graphqlÂ <strong>gatewayâ€™s tax</strong>Â on making data strictly typed after all data is resolved. It grows with the amount of data you transfer.</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/1400/1*KKchwFbhA817Ok5Eugq7hQ.png alt=https://miro.medium.com/max/1400/1*KKchwFbhA817Ok5Eugq7hQ.png class=img_sJtY></p>
<p>We needed to find the slowest resolvers because the latency of the entire request depends entirely on them. It was pretty infuriating to see 28 out of 30 resolvers reply in 40ms time.. and 2 of the APIs taking 500ms, because they didnâ€™t have any cache.</p>
<p>We had to move some of these endpoints out of the initialization query to create better latency. So we actually make 3â€“5 separate graphql queries from frontend, depending on when query is requested (also with some debounce logic).</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=do-not-track-performance-in-production><strong>Do not track performance (in production)</strong><a href=#do-not-track-performance-in-production class=hash-link aria-label="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° do-not-track-performance-in-production" title="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° do-not-track-performance-in-production">â€‹</a></h2>
<p>The counter-intuitive clickbait heading here actually means that you should avoid using APMs in production for graphql gateway or apollo serverâ€™s built-inÂ <a href=https://www.apollographql.com/docs/apollo-server/api/apollo-server/#apolloserver target=_blank rel="noopener noreferrer">tracing<!-- -->:true</a>.</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/1400/1*u0oVzzJPCylM7aR47ZzzHA.png alt=https://miro.medium.com/max/1400/1*u0oVzzJPCylM7aR47ZzzHA.png class=img_sJtY></p>
<p><a href=https://medium.com/@paul_irish/debugging-node-js-nightlies-with-chrome-devtools-7c4a1b95ae27 target=_blank rel="noopener noreferrer">Profiling graphql gateway with Chrome DevTools</a>Â flame chart is not apparent if the function is small but there are many calls to it</p>
<p>Both turning on and removing them resulted in a 2x latency reduction from 700ms to 300ms for our test company. The reason at the time (as I understand) was that the time functions (likeÂ <em>performance.now()</em>) that measure spans for every resolver are too CPU-intensive.</p>
<p><a href="https://www.youtube.com/watch?v=VnG7ej56lWw" target=_blank rel="noopener noreferrer">Ben here</a>Â did a nice benchmark of different backend servers and confirmed this.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=consider-prefetching-on-frontend><strong>Consider prefetching on frontend</strong><a href=#consider-prefetching-on-frontend class=hash-link aria-label="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° consider-prefetching-on-frontend" title="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° consider-prefetching-on-frontend">â€‹</a></h2>
<p>The timing of graphql query on a frontend is tricky. I wanted to move the initial graphql request as early as possible (before vendors.js) in the network waterfall. Doing this granted us some time, but it made the webapp much less maintainable.</p>
<p>To make the query, you needÂ <a href=https://github.com/apollographql/apollo-client target=_blank rel="noopener noreferrer">graphql client</a>Â andÂ <a href=https://github.com/apollographql/graphql-tag target=_blank rel="noopener noreferrer">gql literal parsing</a>Â and these typically would come via vendors.js. Now you would either need to bundle them separately or make a query withÂ <a href=https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch target=_blank rel="noopener noreferrer">raw fetch</a>. Even if you do make a raw request, youâ€™ll need to manage the response gracefully so that the response gets propagated into the correct models, (but those are initialized until later). So it made sense to not continue with this and maybe resort to server-side-rendering orÂ <a href=https://medium.com/samsung-internet-dev/a-beginners-guide-to-service-workers-f76abf1960f6 target=_blank rel="noopener noreferrer">service workers</a>Â in the future.</p>
<p><img decoding=async loading=lazy src=https://miro.medium.com/max/1400/1*GZSPDEh_sZrYsl2OHxxG_A.png alt=https://miro.medium.com/max/1400/1*GZSPDEh_sZrYsl2OHxxG_A.png class=img_sJtY></p>
<p>Moving /graphql call earlier in the chain of network requests (Google Chrome inspector)</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=evaluate-query-complexity><strong>Evaluate query complexity</strong><a href=#evaluate-query-complexity class=hash-link aria-label="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° evaluate-query-complexity" title="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° evaluate-query-complexity">â€‹</a></h2>
<p>What makes graphql unique from REST is that you can estimate how complicated a clientâ€™s request is going to be for your infrastructure before processing it. This is based purely on what he requests and how you define execution costs for your schema. If the estimated cost is too big, we reject the request, similar to ourÂ <a href=https://pipedrive.readme.io/docs/core-api-concepts-rate-limiting target=_blank rel="noopener noreferrer">rate limiting</a>.</p>
<p>We first triedÂ <a href=https://github.com/pa-bru/graphql-cost-analysis target=_blank rel="noopener noreferrer">graphql-cost-analysis</a>Â library but ended up creating our own because we wanted logic to take into account pagination multipliers, nesting, and impact types (network, I/O, DB, CPU). Though the hardest part is injecting custom cost directive into gateway & schema-registry. I hope we can opensource it too in the near future.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=schema-has-many-faces><strong>Schema has many faces</strong><a href=#schema-has-many-faces class=hash-link aria-label="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° schema-has-many-faces" title="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° schema-has-many-faces">â€‹</a></h2>
<p>Working with schema in js/typescript on a low level is confusing. You figure it out when you try to integrate federation into your existing graphql service.</p>
<p>For example, plainÂ <a href=https://github.com/graphql-community/koa-graphql#options target=_blank rel="noopener noreferrer">koa-graphql</a>Â andÂ <a href=https://www.apollographql.com/docs/apollo-server/v1/servers/koa/ target=_blank rel="noopener noreferrer">apollo-server-koa</a>Â setups expect a nestedÂ <a href=https://github.com/graphql/graphql-js#using-graphqljs target=_blank rel="noopener noreferrer"><strong>GraphQLSchema</strong></a>Â param that includes resolvers, but federated apollo/serverÂ <a href=https://www.apollographql.com/docs/apollo-server/federation/implementing-services/#generating-a-federated-schema target=_blank rel="noopener noreferrer">wants schema to be passed separately</a>:</p>
<div class="codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-text codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token plain">buildFederatedSchema([{typeDefs, resolvers}])</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² Ğ±ÑƒÑ„ĞµÑ€ Ğ¾Ğ±Ğ¼ĞµĞ½Ğ°" title=Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>In another case, you may want to define schema as an inlineÂ <a href=https://github.com/apollographql/graphql-tag target=_blank rel="noopener noreferrer">gql tag</a>Â string or store it as schema.graphql file, but when you want to do cost evaluation, you may need it asÂ <a href=https://github.com/graphql/graphql-js/blob/master/src/language/ast.js target=_blank rel="noopener noreferrer">ASTNode</a>Â (<a href=https://github.com/graphql/graphql-js/blob/d4c82e0849318d045107321c6655c1a5da37b798/src/language/parser.d.ts#L58 target=_blank rel="noopener noreferrer">parse</a>Â /Â <a href=https://github.com/graphql/graphql-js/blob/dd0297302800347a20a192624ba6373ee86836a3/src/utilities/buildASTSchema.js#L121 target=_blank rel="noopener noreferrer">buildASTSchema</a>).</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=gradual-canary-rollout><strong>Gradual canary rollout</strong><a href=#gradual-canary-rollout class=hash-link aria-label="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° gradual-canary-rollout" title="ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° gradual-canary-rollout">â€‹</a></h2>
<p>During the mission, we did a gradual rollout to all internalÂ <strong>developers first</strong>Â to catch obvious errors.</p>
<p>By the end of the mission, in February, we released graphql only to 100 lucky companies. We then slowly rolled it out to 1000 â€” 1%, 10%, 30%, 50%, and finally 100% of the customers finishing it in June.</p>
<p>The rollout was based on company ID and modulo logic. We also had allow- and deny-lists for test companies and for cases when developers didnâ€™t want their companies to have graphql on yet. We also had an emergency off-switch that would revert it, which was handy during incidents to ease debugging</p>
<p>Considering how big of a change we did, it was a great way to get feedback and find bugs, while having lower risks for our customers.</p>
<h1><strong>Hopes & dreams</strong></h1>
<p>To get all of the graphql benefits, we need to adopt mutations,Â <strong>subscriptions,</strong>Â and batch operations on a federated level. All of this needs teamwork & internal evangelism to expand theÂ <strong>number of federated services.</strong></p>
<p>Once graphql is stable and sufficient enough for our customers, it can become version 2 of our public API. A public launch would need directives to limit entity access based onÂ <a href=https://oauth.net/2/scope/ target=_blank rel="noopener noreferrer">OAuth scopes</a>Â (for marketplace apps) and ourÂ <a href=https://www.pipedrive.com/en/pricing target=_blank rel="noopener noreferrer">product suites</a>.</p>
<p>For schema-registry, we needÂ <strong>tracking clients,</strong>Â and gettingÂ <strong>usage analytics</strong>Â for better deprecation experience,Â <strong>filtering</strong>/highlighting of schemasâ€™ costs & visibility,Â <strong>naming validation</strong>, managing non-ephemeralÂ <strong>persisted queries</strong>, public schemaÂ <strong>change history</strong>.</p>
<p>As we have services inÂ <a href=https://golang.org/ target=_blank rel="noopener noreferrer">go</a>, it's unclear how internal communication should happen â€” over GRPC for speed & reliability, or individual graphql endpoints, or via centralized internal graphql gateway? If GRPC is better only due to its binary nature, could we make graphql binary instead withÂ <a href=https://msgpack.org/ target=_blank rel="noopener noreferrer">msgpack</a>?</p>
<p>As for the outside world, I hope Apolloâ€™s roadmap withÂ <a href="https://www.youtube.com/watch?v=MvHzOwdLb_o" target=_blank rel="noopener noreferrer">project Constellation</a>Â will optimizeÂ <em>Query planner</em>Â inÂ <a href=https://www.rust-lang.org/ target=_blank rel="noopener noreferrer">Rust</a>Â so that we donâ€™t see that 10%Â <em>gateway tax</em>Â on performance, as well as enable flexible federation of services without their knowledge.</p>
<p>Exciting times to enjoy software development, full of complexity!</div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><a href="https://github.com/tot-ra/kurapov.ee/tree/main/blog/tech/Journey to a Federated GraphQL.md" target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_wrwg aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>ĞÑ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ñƒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ</a></div><div class="col lastUpdated_VnXK"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ Ğ¿Ğ¾ÑÑ‚Ğ° Ğ±Ğ»Ğ¾Ğ³Ğ°"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/tech/Dream of scalable & enriched graphql-subscriptions"><div class=pagination-nav__sublabel>Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ¿Ğ¾ÑÑ‚</div><div class=pagination-nav__label>Dream of scalable & enriched graphql-subscriptions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/tech/backend/ĞŸÑƒÑ‚ÑŒ Ğº Ğ¤ĞµĞ´ĞµÑ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¼Ñƒ GraphQL"><div class=pagination-nav__sublabel>ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ğ¾ÑÑ‚</div><div class=pagination-nav__label>ĞŸÑƒÑ‚ÑŒ Ğº Ğ¤ĞµĞ´ĞµÑ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¼Ñƒ GraphQL</div></a></nav></main><div class="col col--2"><div class="tableOfContents_m6jX thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#gathering-developer-expectations class="table-of-contents__link toc-highlight"><strong>Gathering developer expectations</strong></a><li><a href=#manage-your-schema class="table-of-contents__link toc-highlight"><strong>Manage your schema</strong></a><li><a href=#version-your-schema class="table-of-contents__link toc-highlight"><strong>Version your schema</strong></a><li><a href=#defining-schema-based-on-existing-rest-is-not-so-straightforward class="table-of-contents__link toc-highlight"><strong>Defining schema based on existing REST is not so straightforward</strong></a><li><a href=#cqrs-and-cache class="table-of-contents__link toc-highlight"><strong>CQRS and cache</strong></a><li><a href=#track-performance class="table-of-contents__link toc-highlight"><strong>Track performance</strong></a><li><a href=#do-not-track-performance-in-production class="table-of-contents__link toc-highlight"><strong>Do not track performance (in production)</strong></a><li><a href=#consider-prefetching-on-frontend class="table-of-contents__link toc-highlight"><strong>Consider prefetching on frontend</strong></a><li><a href=#evaluate-query-complexity class="table-of-contents__link toc-highlight"><strong>Evaluate query complexity</strong></a><li><a href=#schema-has-many-faces class="table-of-contents__link toc-highlight"><strong>Schema has many faces</strong></a><li><a href=#gradual-canary-rollout class="table-of-contents__link toc-highlight"><strong>Gradual canary rollout</strong></a></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğµ Ğ¼Ñ‹ÑĞ»Ğ¸</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://www.tiktok.com/@artkurapov target=_blank rel="noopener noreferrer" class=footer__link-item>TikTok<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://twitter.com/tot_ra target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.threads.com/@tot_ra target=_blank rel="noopener noreferrer" class=footer__link-item>Threads<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://t.me/+4kDpExZlraQ0NGZk target=_blank rel="noopener noreferrer" class=footer__link-item>Telegram<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://bsky.app/profile/tot-ra.bsky.social target=_blank rel="noopener noreferrer" class=footer__link-item>Bluesky<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://vk.com/artkurapov target=_blank rel="noopener noreferrer" class=footer__link-item>Ğ’ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğµ<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://tot-ra.livejournal.com/ target=_blank rel="noopener noreferrer" class=footer__link-item>Ğ–Ğ–<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>Business</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://calendly.com/artkurapov/30min target=_blank rel="noopener noreferrer" class=footer__link-item>Calendly<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.linkedin.com/in/kurapov/ target=_blank rel="noopener noreferrer" class=footer__link-item>LinkedIn<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://github.com/tot-ra target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://medium.com/@tot_ra target=_blank rel="noopener noreferrer" class=footer__link-item>Medium<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href="https://stackoverflow.com/users/158448/artjom-kurapov?tab=profile" target=_blank rel="noopener noreferrer" class=footer__link-item>Stack Overflow<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.slideshare.net/totra/presentations target=_blank rel="noopener noreferrer" class=footer__link-item>Slideshare<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://habr.com/ru/users/tot_ra/posts/ target=_blank rel="noopener noreferrer" class=footer__link-item>Habr<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://www.youtube.com/user/artkurapov/ target=_blank rel="noopener noreferrer" class=footer__link-item>Long videos on Youtube<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.twitch.tv/tot_ra/ target=_blank rel="noopener noreferrer" class=footer__link-item>Streams on Twitch<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.instagram.com/tot_ra/ target=_blank rel="noopener noreferrer" class=footer__link-item>ĞŸÑ€Ğ¸Ñ€Ğ¾Ğ´Ğ° Ğ² Instagram<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.facebook.com/artkurapov target=_blank rel="noopener noreferrer" class=footer__link-item>Facebook<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.reddit.com/user/tot_ra/ target=_blank rel="noopener noreferrer" class=footer__link-item>Reddit<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>Multimedia</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://suno.com/@tot_ra target=_blank rel="noopener noreferrer" class=footer__link-item>Music on Suno<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://goodreads.com/tot_ra target=_blank rel="noopener noreferrer" class=footer__link-item>Books on Goodreads<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://steamcommunity.com/id/tot_ra/ target=_blank rel="noopener noreferrer" class=footer__link-item>Games on Steam<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://open.spotify.com/user/1176479585 target=_blank rel="noopener noreferrer" class=footer__link-item>Music on Spotify<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://soundcloud.com/tot_ra target=_blank rel="noopener noreferrer" class=footer__link-item>Music on Soundcloud<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.thingiverse.com/tot_ra/designs target=_blank rel="noopener noreferrer" class=footer__link-item>3D models on Thingiverse<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.pinterest.com/tot_ra/ target=_blank rel="noopener noreferrer" class=footer__link-item>Pinterest<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright Â© 2025</div></div></div></footer></div>