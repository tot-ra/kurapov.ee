<!doctype html><html lang=ru dir=ltr class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>19 записей с тегом "backend" | Артём Курапов</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://kurapov.ee/img/docusaurus-social-card.jpg><meta data-rh=true name=twitter:image content=https://kurapov.ee/img/docusaurus-social-card.jpg><meta data-rh=true property=og:url content=https://kurapov.ee/blog/tags/backend><meta data-rh=true property=og:locale content=ru><meta data-rh=true name=docusaurus_locale content=ru><meta data-rh=true name=docsearch:language content=ru><meta data-rh=true property=og:title content='19 записей с тегом "backend" | Артём Курапов'><meta data-rh=true name=docusaurus_tag content=blog_tags_posts><meta data-rh=true name=docsearch:docusaurus_tag content=blog_tags_posts><link data-rh=true rel=icon href=/img/favicon/favicon.ico><link data-rh=true rel=canonical href=https://kurapov.ee/blog/tags/backend><link data-rh=true rel=alternate href=https://kurapov.ee/blog/tags/backend hreflang=ru><link data-rh=true rel=alternate href=https://kurapov.ee/blog/tags/backend hreflang=x-default><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Артём Курапов RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Артём Курапов Atom Feed"><link rel=stylesheet href=/assets/css/styles.e35a0b51.css><script src=/assets/js/runtime~main.a08a89fc.js defer></script><script src=/assets/js/main.f34d6c5c.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Перейти к основному содержимому"><a class=skipToContent_aCxL href=#__docusaurus_skipToContent_fallback>Перейти к основному содержимому</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Переключить навигационную панель" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/artjom.jpg alt="Artjom Kurapov" class="themedComponent_cfDz themedComponent--light_Kj2W"><img src=/img/artjom.jpg alt="Artjom Kurapov" class="themedComponent_cfDz themedComponent--dark__Nfe"></div><b class="navbar__title text--truncate">Артём Курапов</b></a><a class="navbar__item navbar__link" href="/docs/Об авторе">Об авторе</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/blog>Блог</a></div><div class="navbar__items navbar__items--right"><a href=https://github.com/tot-ra/kurapov.ee target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="toggle_LxwK colorModeToggle_c2rS"><button class="clean-btn toggleButton_gSiH toggleButtonDisabled_GY0v" type=button disabled title="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-label="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_WH3Q><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_OWtW><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_vXry></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_jkFy"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_aM6_ thin-scrollbar" aria-label="Навигация по последним постам в блоге"><div class="sidebarItemTitle_Dvxs margin-bottom--md">Последние заметки</div><div role=group><h3 class=yearGroupHeading_ZKt1>2025</h3><ul class="sidebarItemList_X9hj clean-list"><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2025/05/07/события/ AWS Gen AI meetup"> AWS Gen AI meetup</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2025/04/29/события/ AGI - Beyond the Hype Before the Storm">AGI: Beyond the Hype, Before the Storm</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2025/04/28/события/ Decentralized AI event"> Decentralized AI event</a></ul></div><div role=group><h3 class=yearGroupHeading_ZKt1>2024</h3><ul class="sidebarItemList_X9hj clean-list"><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2024/12/13/события/ Tallinn AI meetup"> Tallinn AI meetup</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/2024/11/26/события/ AI meetup notes"> AI meetup notes</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href=/blog/2024/11/14/события/AI-ED-Webinar>Andmete ja tehisintellekti olulisusest personaliseerituma õppe poole liikumisel by Innar Liiv</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/кино/The Wild Robot">кино/The Wild Robot</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href='/blog/управление/Product team models - project based, "feature factory" and product operating model'>Product team models - project based, feature factory and product operating model</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/tech/devices/Моя коллекция часов в 2024">Моя коллекция часов в 2024</a><li class=sidebarItem_hoJQ><a class=sidebarItemLink_rV_M href="/blog/tech/soft/Как записывать экран с круглой камерой">Как записывать экран с круглой камерой</a></ul></div></nav></aside><main class="col col--7"><header class=margin-bottom--xl><h1>19 записей с тегом "backend"</h1><a href=/blog/tags>Посмотреть все теги</a></header><article class=margin-bottom--xl><header><h2 class=title_Y5lg><a href="/blog/tech/backend/Путь к Федеративному GraphQL">Путь к Федеративному GraphQL</a></h2><div class="container__LhH margin-vert--md"><time datetime=2020-09-09T10:00:00.000Z>9 сентября 2020 г.</time> · <!-- -->14 мин. чтения</div></header><div class=markdown><p><img decoding=async loading=lazy src=/assets/images/e28dc66e8bb64f31576418ef1b102685-d28033219b614b9e24f66c8824864013.png width=1400 height=767 class=img_sJtY></p>
<p>Картинка с dgraph.io</p>
<p>Программисты любят хорошие истории, поэтому надеюсь что пятилетний путь к композитному API с помощью GraphQL в боевой среде (на пике выдающей 110 запросов в секунду при 100мс задержке) будет интересен.</p>
<p>[Если вы спешите, проскрольте ниже к <em>урокам</em> и гляньте на открытый код <a href=https://github.com/pipedrive/graphql-schema-registry target=_blank rel="noopener noreferrer">graphql-schema-registry</a>]</p>
<p><img decoding=async loading=lazy src=/assets/images/c0651522464466d29683331192513234-0d6725afcb058e05cf879c4af95bb1dc.png width=1400 height=726 class=img_sJtY></p>
<p>schema registry с примером тестовой схемы</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=задача>Задача<a href=#задача class=hash-link aria-label="Прямая ссылка на Задача" title="Прямая ссылка на Задача">​</a></h2>
<p>Годами, <a href=https://www.pipedrive.com/ target=_blank rel="noopener noreferrer">Pipedrive</a> (которому в начале 2020 стукнуло уже 10 лет), давал публичный <a href=https://developers.pipedrive.com/docs/api/v1/ target=_blank rel="noopener noreferrer">REST API</a> где были и недокументированные пути для нашего веб приложения. Один из них /users/self, который изначально задумывался для загрузки информации о пользователе, нормально с течением времени стал грузить все что надо для первой загрузки страницы, доходя до 30 разных типов сущностей. Сам он выдавался PHP монолитом, который по натуре синхронный. Мы <a href=https://medium.com/pipedrive-engineering/how-two-developers-accelerated-php-monolith-in-pipedrive-df8a18bc2d8a target=_blank rel="noopener noreferrer">пытались его распараллелить</a>, но неудачно.
<img decoding=async loading=lazy src=/assets/images/2f8932407cb9eab3eed55e354353c688-c614b3189765bdaf3f9679fef3bcd6f7.png width=1000 height=273 class=img_sJtY>
/users/self распределение задержки для оставшегося траффика</p>
<p>С точки зрения поддержки, каждое новое изменение все больше усложняло код и никто не хотел владеть этой огромной функцией.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=прототип-с-прямым-доступом-к-бд>Прототип с прямым доступом к БД<a href=#прототип-с-прямым-доступом-к-бд class=hash-link aria-label="Прямая ссылка на Прототип с прямым доступом к БД" title="Прямая ссылка на Прототип с прямым доступом к БД">​</a></h2>
<p>Давайте вернемся назад в прошлое, когда наши разработчики стали экспериментировать с graphql.</p>
<p>Года 3-4 назад, в команде разработки <a href=https://marketplace.pipedrive.com/ target=_blank rel="noopener noreferrer">рынка приложений</a>, я услышал от <a href=https://twitter.com/bashmach target=_blank rel="noopener noreferrer">Паши</a>, нашего фулл-стек разработчика новенькие для меня термины - <a href=https://elixir-lang.org/ target=_blank rel="noopener noreferrer">elixir</a> и graphql. Он участвовал в тестовом проекте в котором напрямую работал с MySQL и выдавал основные сущности Pipedrive по /graphql.</p>
<p>На локальной машине работало прекрасно, но это не масштабировалось на весь код, потому что функционал - не обычный CRUD, а весь монолит переписывать никто не хотел.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=прототип-со-склейкой>Прототип со склейкой<a href=#прототип-со-склейкой class=hash-link aria-label="Прямая ссылка на Прототип со склейкой" title="Прямая ссылка на Прототип со склейкой">​</a></h2>
<p>Переносимся в 2019, когда я заметил еще один тестовый репозиторий от другого коллеги, который стал использовать GraphQL stitching с определением сущностей с помощью <a href=https://github.com/graphql-compose/graphql-compose target=_blank rel="noopener noreferrer">graphql-compose</a> и резолверами которые делали запрос уже к нашему REST API. Как можете представить, это уже было значительным улучшением, потому что нам не надо было переопределять всю бизнес-логику и graphql становился просто приятной оберткой.</p>
<p>Из недостатков этого решения:</p>
<ul>
<li>
<p><strong>Производительность</strong>. Небыло <a href=https://github.com/graphql/dataloader target=_blank rel="noopener noreferrer">dataloader</a>'а, поэтому был риск N+1 сетевых запросов. Небыло ограничения сложности запроса и какого-либо промежуточного кеширования.</p>
</li>
<li>
<p><strong>Управление схемой</strong>. При склейке типов, мы определяли все сущности в одном репозитории, отдельно от самих сервисов которые этими даннами владеют. Это усложняло деплой - приходилось бы писать обратно-совместимые изменения, что-бы избегать несовпадения схемы и функций.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=подготовка>Подготовка<a href=#подготовка class=hash-link aria-label="Прямая ссылка на Подготовка" title="Прямая ссылка на Подготовка">​</a></h2>
<p>В Октябре 2019, я стал готовиться к <a href="https://www.youtube.com/watch?v=ekKp-tA0A9k" target=_blank rel="noopener noreferrer">миссии</a>, которая превратила бы прошлое решение в рабочее с помощью Apollo федерации, которая <a href=https://www.apollographql.com/blog/apollo-federation-f260cf525d21/ target=_blank rel="noopener noreferrer">вышла чуть ранее</a> в этом же году. Кроме того, результат приземлился бы в команде <em>Core</em>, которая стала бы поддерживать его в долгосрочной перспективе.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=сбор-ожиданий-разработчиков>Сбор ожиданий разработчиков<a href=#сбор-ожиданий-разработчиков class=hash-link aria-label="Прямая ссылка на Сбор ожиданий разработчиков" title="Прямая ссылка на Сбор ожиданий разработчиков">​</a></h2>
<p>В компании некоторые разработчики были довольно скептичны и предлагали построить свое решение просто склеивая запросы воедино, отправляя по POST и надеясь на свой gateway который будет распараллеливать обработку.</p>
<p>Другие считали что graphql еще слишком сырой что-бы использовать в жизни и лучше подождать. Третьи предлагали рассмотреть альтернативы, типа Protobuf и Thrift, а в качестве транспорта рассмотреть <a href=https://grpc.io/ target=_blank rel="noopener noreferrer">GRPC</a>, <a href=https://www.odata.org/ target=_blank rel="noopener noreferrer">OData</a>.</p>
<p>Четвертые напротив, на полном ходу писали graphql под одиночные сервисы (insights, teams) и выкатывали в лайв, однако не могли повторно использовать сущности (например User). В <a href=https://www.pipedrive.com/en/jobs/czech-republic target=_blank rel="noopener noreferrer">Праге</a> ребята написали все на typescript + <a href=https://relay.dev/ target=_blank rel="noopener noreferrer">relay</a> на фронтенде, который нам еще предстоит <a href=https://github.com/apollographql/apollo-server/issues/3159 target=_blank rel="noopener noreferrer">перенести в федерацию</a>.</p>
<p>Изучать новую технологию было круто.</p>
<p>Строгий, само-документирующийся API для фронтендеров? Глобально определяемые сущности уменьшающие дублирование и улучшающие прозрачность и владение среди всех команд? Gateway который автоматом делает под-запросы и между сервисами без избыточной выборки? Ухх.</p>
<p>Впрочем, я знал что нам понадобится управлять схемой как-то динамически, что-бы не полагаться на захардкоженые значения и видеть что происходит. Нечно типа <a href=https://docs.confluent.io/current/schema-registry/index.html target=_blank rel="noopener noreferrer">Confluent’s schema-registry</a> или <a href=https://bitbucket.org/atlassian/graphql-braid/src/master/ target=_blank rel="noopener noreferrer">Atlassian’s Braid</a>, но они либо под Кафку делались, либо на Java, которую мы не хотели поддерживать.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=план>План<a href=#план class=hash-link aria-label="Прямая ссылка на План" title="Прямая ссылка на План">​</a></h2>
<p>Я выступил с инженерной миссией у которой было 3 цели:</p>
<ul>
<li>
<p>Уменьшение первичной загрузки страницы (<em>воронка продаж</em>) на 15%. Достижимо если заменить некоторые REST запросы в один /graphql</p>
</li>
<li>
<p>Уменьшение траффика на 30%. Достижимо если перенести загрузку всех <em>сделок для воронки продаж</em> в graphql и спрашивать меньше свойств.</p>
</li>
<li>
<p>Использовать строгую типизацию (что-бы фронтендерам надо было писать меньше кода в <a href=https://en.wikipedia.org/wiki/Defensive_programming target=_blank rel="noopener noreferrer">защитном стиля</a>)</p>
</li>
</ul>
<p>Мне повезло, <a href=https://github.com/pipedrive/graphql-schema-registry#honorable-mentions target=_blank rel="noopener noreferrer">трое разработчиков</a> присоединились к миссии, в т.ч. автор прототипа.</p>
<p><img decoding=async loading=lazy src=/assets/images/55e6e4675e2b2ad39f82f66a62e4d05f-b70655d5cee90146aec68a775ece72e5.png width=946 height=477 class=img_sJtY></p>
<p>Сетевые запросы по мере загрузки веб-приложения</p>
<p>Изначальный план по сервисам выглядел так:
<img decoding=async loading=lazy src=/assets/images/e21b54c336353f713dfb5e6cd8a353f2-22c6ebd4a113c37e872623e90991f19f.png width=1400 height=606 class=img_sJtY></p>
<p>Сервисы над которыми предстояло бы работать</p>
<p>Тут schema-registry был бы общим сервисом, который мог бы хранить схему любого типа, получая на входе что вы в него кинете (swagger, typescript, graphql, avro, proto). На выходе он мог бы так же выдавать что вы хотите.</p>
<p>Gateway периодически опрашивал бы schema-registry и вызывал бы уже сервисы которые владеют данными согласно запросу и схеме. В свою очередь frontend компоненты могли бы скачивать актуальную схему для autocomplete и самих запросов.</p>
<p>На деле впрочем, мы сделали только поддержку graphql формата, потому что для федерации его было достаточно, а время как обычно быстро закончилось.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=итоги>Итоги<a href=#итоги class=hash-link aria-label="Прямая ссылка на Итоги" title="Прямая ссылка на Итоги">​</a></h2>
<p>Главную цель по замене /users/self в веб-приложении мы сделали в течение первых двух недель ? (ничоси!). А вот полировка всего решения что-бы оно быстро и надежно работало, заняло все оставшееся время.</p>
<p>К концу миссии (в феврале 2020), мы каким-то чудом достигли 13% ускорения первой загрузки страницы и 25% ускорения при повторной загрузке (из-за добавленного кеширования), согласно синтетическому UI тесту который мы гоняли на <a href=https://www.datadoghq.com/ target=_blank rel="noopener noreferrer">Datadog</a>.</p>
<p>Уменьшить трафик нам не удалось, потому что мы не достигли рефакторинга вида воронки продаж - там все еще REST.</p>
<p>Что-бы ускорить добавление сервисов в федерацию другими командами (у нас 600+ человек), мы записали обучающие видео что-бы все были в курсе как оно все работает вместе. После окончания миссии IOS- и Android- клиенты тоже мигрировали на graphql и в целом были рады.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=выученные-уроки>Выученные уроки<a href=#выученные-уроки class=hash-link aria-label="Прямая ссылка на Выученные уроки" title="Прямая ссылка на Выученные уроки">​</a></h2>
<p>Глядя на дневник миссии из этих 60 дней, могу выделить наибольшие трудности что-бы вам было бы попроще</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=управляйте-своей-схемой>Управляйте своей схемой<a href=#управляйте-своей-схемой class=hash-link aria-label="Прямая ссылка на Управляйте своей схемой" title="Прямая ссылка на Управляйте своей схемой">​</a></h2>
<blockquote>
<p>_Могли бы мы построить это сами? Возможно, но это не было бы так отполировано.<br>
<!-- -->_<a href=https://medium.com/paypal-engineering/scaling-graphql-at-paypal-b5b5ac098810 target=_blank rel="noopener noreferrer"><em>Mark Stuart, Paypal Engineering</em></a></p>
</blockquote>
<p>В течение первых пары дней я попробовал <a href=https://studio.apollographql.com/ target=_blank rel="noopener noreferrer">Apollo studio</a> и их <a href=https://www.apollographql.com/docs/studio/schema-checks/#the-check-process target=_blank rel="noopener noreferrer">инструментарий</a> для терминала по проверке схемы. Сервис прекрасный и работает из коробки с минимальными настройками gateway.</p>
<p><img decoding=async loading=lazy src=https://habrastorage.org/r/w1560/getpro/habr/upload_files/166/7a4/d4f/1667a4d4f5851f4095d94a7bdf8ab8d7.png alt="Написанный нами инструментарий для валидации схемы" title="Написанный нами инструментарий для валидации схемы" class=img_sJtY></p>
<p>Написанный нами инструментарий для валидации схемы</p>
<p>Однако несмотря на все фишки этого облачного сервиса, я посчитал что для такого важного дела как маршрутизация траффика было бы опрометчиво полагаться на сторонний сервис из-за рисков для жизнеспособности нашего дела, несмотря на богатый функционал и сколько-то выгодные расценки. Поэтому мы написали свой сервис с минимально нужным функционалом и теперь отправили его в opensource -  <a href=https://github.com/pipedrive/graphql-schema-registry target=_blank rel="noopener noreferrer"><strong>graphql-schema-registry</strong></a> .</p>
<p>Вторая причина была в том что-бы следовать модели <a href=https://medium.com/pipedrive-engineering/tanker-the-story-of-multi-dc-customer-data-migration-framework-ad842c2c6b9c target=_blank rel="noopener noreferrer">распределенной архитектруры датацентров</a> Pipedrive. У нас нет центрального датацентра, каждый DC самодостаточен. Это дает нам как более высокую надежность, так и способность открывать новые датацентры в Китае, России, Иране или на Марсе ?</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=версионируйте-свою-схему>Версионируйте свою схему<a href=#версионируйте-свою-схему class=hash-link aria-label="Прямая ссылка на Версионируйте свою схему" title="Прямая ссылка на Версионируйте свою схему">​</a></h2>
<p>Федеративная схема и graphql gateway очень хрупкие. Если у вас появится конфликт имен у типов или неверная ссылка между типами в одном из сервисов, то gateway может этого не пережить.</p>
<p>По умолчанию, gateway напрямую <a href=https://www.apollographql.com/docs/apollo-server/federation/introduction/#gateway-example target=_blank rel="noopener noreferrer">опрашивает все сервисы</a> касательно их схемы, поэтому достаточно одного из сервисов с ошибкой что-бы поломать всем трафик. Apollo studio решает это посредством проверки схемы еще до деплоя и отказе если видит какой-то конфликт.</p>
<p>Проверка совместимости схем правильный подход, но конкретное решение у Apollo зависит от их внутреннего состояния, т.к. они хранят правильную склеенную схему на данный момент. Это делает <a href=https://www.apollographql.com/docs/studio/schema/schema-reporting-protocol/#protocol-sequence target=_blank rel="noopener noreferrer">протокол регистрации</a> сложным и <a href=https://www.apollographql.com/docs/studio/schema/schema-reporting/#rolling-deploys-with-schema-reporting target=_blank rel="noopener noreferrer">зависящим от времени</a>.</p>
<p>Мы же напротив, связали версии микросервисов (генерируемые на основе хешей докер-образов) со схемой. Микросервисы регистрируют уже в ходе своей работы и делают это один раз без <a href=https://www.apollographql.com/docs/studio/schema/schema-reporting/#rolling-deploys-with-schema-reporting target=_blank rel="noopener noreferrer">последующих повторений</a>. Gateway делает выборку всех федерированных сервисов из <a href=https://www.consul.io/ target=_blank rel="noopener noreferrer">консула</a> и спрашивает schema-registry составить схему /schema/compose , предоставляя их версии.</p>
<p>Если schema-registry видит что предоставленные версии несовместимы, она откатывается на прошлые версии
<img decoding=async loading=lazy src=/assets/images/ac6951a7e0a2933369f74b934e035e80-0a00afabffc98cc17c18fc5e4823e352.png width=1400 height=580 class=img_sJtY>
<img decoding=async loading=lazy src=/assets/images/3feed981ef1fc75944a76cf3754056b5-a5f59d03438a4c3e8abc7ab59701340e.png width=1304 height=616 class=img_sJtY></p>
<p>Регистрация схемы при старте сервиса</p>
<p>Микросервисы могут выдавать как REST так и Graphql API, поэтому мы используем оповещения тревоги при неудачной регистрации схемы, оставляя при этом работу REST.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=определение-схемы-на-основе-rest-не-просто>Определение схемы на основе REST не просто<a href=#определение-схемы-на-основе-rest-не-просто class=hash-link aria-label="Прямая ссылка на Определение схемы на основе REST не просто" title="Прямая ссылка на Определение схемы на основе REST не просто">​</a></h2>
<p>Поскольку я не знал как лучше перенести схему из нашего REST в graphql, я сначала попробовал <a href=https://github.com/IBM/openapi-to-graphql target=_blank rel="noopener noreferrer">openapi-to-graphql</a>, нормально наша документация на тот момент не имела детального описания запросов и ответов.</p>
<p><img decoding=async loading=lazy src=/assets/images/2fc46dbba5892bd114758c2604b48e46-8096847fb11461df9769b79d501d3dec.png width=772 height=518 class=img_sJtY>
Спрашивать у каждой команды что-бы они написали бы ее, очевидно заняло бы уйму времени, поэтому мы определили основные сущности сами ? просто глядя на ответ при разных REST запросах.</p>
<p>В дальнейшем это нам аукнулось, так как оказалось что REST API иногда зависит от того кто делает запрос, либо зависит от внутреннего состояния и логики.
<img decoding=async loading=lazy src=/assets/images/b30de9ea845324d1f49bb1a79e5b4acb-b6a0e7a1508a3f9340be13c7ab8f3e58.png width=1230 height=517 class=img_sJtY></p>
<p>Например после настраиваемые <em>поля данных</em> меняют REST API в зависимости от пользователя. Если его добавить к сделке, то он оно будет выдаваться с ключем-хешем на уровне deal.pipeline_id. С федеративным graphql, динамическая схема невозможно, поэтому нам пришлось передвигать эти настраиваемые поля в отдельный список</p>
<p>Другая проблема это стиль наименований в json-ответе. Мы хотели поддерживать верблюжийСтиль, но почти весь REST отвечал нам в змеином_стиле, пришлось пока остаться на смешанном.</p>
<p><img decoding=async loading=lazy src=/assets/images/617cbdac0101669627746edf3b773e48-d3ee145f2aa36b7633c43cb755c1dbc2.png width=1560 height=675 class=img_sJtY></p>
<p>федеративный граф данных Pipedrive (слева) с 2 сервисами (из 539) и еще-не-федеративный граф сервиса leads (справа)</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=cqrs-и-кеш>CQRS и кеш<a href=#cqrs-и-кеш class=hash-link aria-label="Прямая ссылка на CQRS и кеш" title="Прямая ссылка на CQRS и кеш">​</a></h2>
<p>Модель данных в Pipedrive не может полагаться на простой TTL-кеш.</p>
<p>Например, когда инженер поддержки создает глобальное оповещение о предстоящем техническом обслуживании приложения из нашей админки, он ожидает что сообщение будет сразу же видно пользователям. Эти глобальные оповещения могут быть адресованы как всем пользователям, так и конкретным компаниям и индивидуальным людям. Чистить такой кеш приходится используя 3 разных ключа.</p>
<p>Что-бы делать параллельные запросы к PHP-монолиту, мы написали сервис на nodejs (назвали его monograph), который кеширует все что отвечает монолит в memcached. Этот кеш надо чистить из монолита в зависимости от бизнес-логики. Это немного антипаттерн, потому что кеш получается общим для разных сервисов и сильно их связывает.</p>
<p><img decoding=async loading=lazy src=/assets/images/a8837cc6450f909abee25a30a2e28981-0cbef379ca0aa9b002bc14f91050f1fd.png width=1232 height=382 class=img_sJtY></p>
<p>Тут можно заметить <a href=https://martinfowler.com/bliki/CQRS.html target=_blank rel="noopener noreferrer">CQRS pattern</a>. Впрочем, такой кеш позволяет ускорять 80% запросов и дает итоговую среднюю задержку такую же как и у монолита.</p>
<p><img decoding=async loading=lazy src=/assets/images/64d0d5bf393aa6ba6bf232332db1d3eb-eddbe86fce681cdb0355bc3cee8535d3.png width=1560 height=401 class=img_sJtY></p>
<p>Время средней задержки ответа монолита (слева) и graphql gateway (справа) в регионе US на основе NewRelic</p>
<p>Еще одна сложность - язык пользователя. Как только он меняется, нам надо чистить уйму разных сущностей - от типов активности до того какие настройки должны быть при показе гугл карт. И что еще хуже - язык уже управляется не в монолите, а был вынесен в отдельный сервис <em>identity</em>. Связывать его с общим кешем очень не хотелось.</p>
<p>Identity владеет данными пользователей, поэтому мы сделали так что он кидает событие через kafka, которое ловит monograph и чистит все нужные кеши. Тут есть недостаток, что событие приходит с задержкой (может максимум 1 сек), поэтому чистка кеша происходит не мгновенно. Нормально это не критично, потому что пользователь не так быстро уходит со страницы что-бы сделать повторный запрос к бекенду и заметить что в кешах еще старый язык.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=следите-за-производительностью>Следите за производительностью<a href=#следите-за-производительностью class=hash-link aria-label="Прямая ссылка на Следите за производительностью" title="Прямая ссылка на Следите за производительностью">​</a></h2>
<p>Производительность была главной целью и для этого нам пришлось хорошо прокачаться в знании APM и выслеживании распределенных запросов между микросервисами что-бы определить самые медленные места. Мы на тот момент использовали Datadog и он хорошо себя зарекомендовал.</p>
<p>Для ускорения, мы кешировали все 30 параллельных запросов в memcached. Но по ходу дела возникали проблемы. Например на картинке слева видно что некоторые резолверы делают запрос в memcached и получают ответ за 10мс, а другие тупят, словно жду своей очереди выростая до 220мс. Как оказалось, это было из-за того что я использовал один и тот же хост <a href=https://github.com/facebook/mcrouter target=_blank rel="noopener noreferrer">mcrouter</a>. Как только я стал их ротировать, мемкеш стал отдавать все за 20мс максимум.</p>
<p>Что-бы уменьшить количество этих сетевых запросов к мемкешу, мы склеили его в один используя <a href=https://github.com/3rd-Eden/memcached#public-methods target=_blank rel="noopener noreferrer">getMulti</a> функцию. Получается что несмотря на то что все resolver'ы выполняются независимо, они блочатся на 5мс с помощью debounce и склеиваются воедино.</p>
<p><img decoding=async loading=lazy src=/assets/images/1dc6beb1bfea7bfe18afdd32f3fbefa6-92e0ffd5c4629b52815bf1b5292bcaca.png width=1560 height=564 class=img_sJtY></p>
<p>На картинке справа видна другая проблема. Эти желтые линии это налог graphql gateway на приведение данных к строгому типу. Причем чем больше данных вы гоняете через сервис, тем дольше будет эта фаза выполнятся.</p>
<p><img decoding=async loading=lazy src=/assets/images/65652f1707e2c00f50b1cae39c4c04b8-2148bc2a79105bb3de31d98d9d45eb77.png width=1000 height=561 class=img_sJtY></p>
<p>Вобщем по ходу миссии постоянно приходилось мониторить какие же запросы нам надо еще закешировать и под конец стало бесить что скажем 28 из 30 запросов прекрасно кешируются, а оставшиеся два мало того что отвечают целых 500мс, так их еще и невозможно легко закешировать.</p>
<p>Нам пришлось вынести их в отдельный graphql запрос, который делается после первого /graphql запроса на инициализацю страницы. Так что сейчас мы на деле делаем уже порядка 3-5 независимых запросов, в зависимости от тайминга фронтенда (там тоже debounce зависящий от параллельной подгрузки FE компонентов)</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=не-следите-з�а-производительностью>Не следите за производительностью<a href=#не-следите-за-производительностью class=hash-link aria-label="Прямая ссылка на Не следите за производительностью" title="Прямая ссылка на Не следите за производительностью">​</a></h2>
<p>Казалось бы полностью противоположный урок, но на деле это значит что в лайв-среде вам лучше отключить мониторинг приложения (APM) и <a href=https://www.apollographql.com/docs/apollo-server/api/apollo-server/#apolloserver target=_blank rel="noopener noreferrer">tracing<!-- -->:true</a>, если вы используете их.</p>
<p><img decoding=async loading=lazy src=/assets/images/7ed98ffd99435aa8f49204f198739783-feb27d1f66a9bc17778ab082878f60fc.png width=1000 height=550 class=img_sJtY></p>
<p>Отключение отслеживания у нас ускорило среднюю задержку в два раза с 700мс до 300мс для нашей тестовой компании. Насколько я понимаю, причина крылась в функциях которые замеряют время (типа performance.now()), которые необходимы для замера каждого резолвера.</p>
<p>Мы делали профайлинг graphql gateway с помощью  <a href=https://medium.com/@paul_irish/debugging-node-js-nightlies-with-chrome-devtools-7c4a1b95ae27 target=_blank rel="noopener noreferrer">Chrome DevTools</a>, но так просто вызов этих мелких функций, раскиданных повсюду не заметишь.</p>
<p><a href="https://www.youtube.com/watch?v=VnG7ej56lWw" target=_blank rel="noopener noreferrer">Бен тут</a> делал замеры и тоже пришел к этому.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=попробуйте-ранний-запрос>Попробуйте ранний запрос<a href=#попробуйте-ранний-запрос class=hash-link aria-label="Прямая ссылка на Попробуйте ранний запрос" title="Прямая ссылка на Попробуйте ранний запрос">​</a></h2>
<p>На фронтенде, время создания graphql запроса для нас оказалось сложновато. Я хотел передвинуть первый /graphql как можно раньше (даже до загрузки всего кода в vendors.js) в графике сетевых запросов. Мы смогли это сделать, но веб-приложение из-за этого стало значительно сложней.</p>
<p>Что-бы делать запрос вам понадобится <a href=https://github.com/apollographql/apollo-client target=_blank rel="noopener noreferrer">graphql клиент</a> и парсинг <a href=https://github.com/apollographql/graphql-tag target=_blank rel="noopener noreferrer">gql литералов</a> для определения самого запроса. Дальше его надо либо выдавать в отдельном bundle, либо отказываться от всех удобств и использовтать сырой <a href=https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch target=_blank rel="noopener noreferrer">fetch</a>. Даже если делать сырой запрос, дальше надо что-то делать с ответом - распределять данные по моделям либо сохранять в глобальную переменную. Вобщем мы решили отказаться от этого и надеяться на server-side-rendering и <a href=https://medium.com/samsung-internet-dev/a-beginners-guide-to-service-workers-f76abf1960f6 target=_blank rel="noopener noreferrer">service workers</a> в будущем.
<img decoding=async loading=lazy src=/assets/images/45a6bc6fa90a4b4d4f92170543daa475-7e0b3c2aac26da753727ff6a62d44712.png width=1400 height=682 class=img_sJtY></p>
<p>Перенос /graphql запроса левей</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=оценивайте-сложность-запроса>Оценивайте сложность запроса<a href=#оценивайте-сложность-запроса class=hash-link aria-label="Прямая ссылка на Оценивайте сложность запроса" title="Прямая ссылка на Оценивайте сложность запроса">​</a></h2>
<p>Чем graphql примечателен, так это то что тут можно оценивать насколько больно запрос клиента будет бить по инфраструктуре не делая при этом еще никакой работы. Для оценки сложности надо указывать цену внутри самой схемы с помощью директив, а дальше делать саму проверку при получении запроса и отклонять его если сложность слишком велика, подобно нашему <a href=https://pipedrive.readme.io/docs/core-api-concepts-rate-limiting target=_blank rel="noopener noreferrer">rate limit</a> на частоту запросов.</p>
<p>Сначала мы попробовали <a href=https://github.com/pa-bru/graphql-cost-analysis target=_blank rel="noopener noreferrer">graphql-cost-analysis</a> библиотеку, но в итоге написали свою, поскольку захотели больше фич - множителях при выдаче списков данных, вложенности и рекурсии, а так же определении типов влияния на инфраструктуру (сетевой запрос, БД, CPU, работа с файлами). Тут сложней всего оказалось внедрять поддержку своей директивы в gateway и schema-registry. Надеюсь мы нашу библиотеку тоже опубликуем.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=у-схемы-много-лиц>У схемы много лиц<a href=#у-схемы-много-лиц class=hash-link aria-label="Прямая ссылка на У схемы много лиц" title="Прямая ссылка на У схемы много лиц">​</a></h2>
<p>Работать со схемой в js/typescript на низком уровне порой мучительно. Это начинаешь понимать когда пробуешь интегрировать существующий graphql сервис в федерацию.</p>
<p>Например настройки <a href=https://github.com/graphql-community/koa-graphql#options target=_blank rel="noopener noreferrer">koa-graphql</a> и <a href=https://www.apollographql.com/docs/apollo-server/v1/servers/koa/ target=_blank rel="noopener noreferrer">apollo-server-koa</a> ожидают что вы создадите вложенный объект  <a href=https://github.com/graphql/graphql-js#using-graphqljs target=_blank rel="noopener noreferrer"><strong>GraphQLSchema</strong></a>  который включает и сами резолверы. Но федеративный apollo/server <a href=https://www.apollographql.com/docs/apollo-server/federation/implementing-services/#generating-a-federated-schema target=_blank rel="noopener noreferrer">хочет схему и резолверы отдельно</a>:</p>
<div class="codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-text codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token plain">buildFederatedSchema([{typeDefs, resolvers}])</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>В другом случае, как я уже писал, вам захочется определить схему с помощью <a href=https://github.com/apollographql/graphql-tag target=_blank rel="noopener noreferrer">gql литерала</a>, или сохранить схему в schema.graphql файл, а когда вам надо будетделать проход по всей схеме для оценки сложности, понадобится <a href=https://github.com/graphql/graphql-js/blob/master/src/language/ast.js target=_blank rel="noopener noreferrer">ASTNode</a> (и функции <a href=https://github.com/graphql/graphql-js/blob/d4c82e0849318d045107321c6655c1a5da37b798/src/language/parser.d.ts#L58 target=_blank rel="noopener noreferrer">parse</a> / <a href=https://github.com/graphql/graphql-js/blob/dd0297302800347a20a192624ba6373ee86836a3/src/utilities/buildASTSchema.js#L121 target=_blank rel="noopener noreferrer">buildASTSchema</a>)</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=плавная-canary-деплой>Плавная canary деплой<a href=#плавная-canary-деплой class=hash-link aria-label="Прямая ссылка на Плавная canary деплой" title="Прямая ссылка на Плавная canary деплой">​</a></h2>
<p>Во время миссии мы выкатывали изменения сначала всем разработчикам что-бы отследить очевидные ошибки.</p>
<p>Под конец миссии в феврале, мы выкатили graphql только на 100 компаний-"везунчиков". Дальше мы медленно выкатывали их до 1000 компаний, потом 1%, 10%, 30%, 50% и наконец в июне выкатили всем.</p>
<p>Деплоили мы просто используя логику деления company ID без остатка. В дополнение, у нас было несколько настроек - кому еще включать, кому не включить никогда и рубильник выключающий graphql сразу у всех на фронтенде. Было очень полезно во время инцидентов сразу избавиться от подозрений что это все из-за нового graphql и упростить дебаг.</p>
<p>Учитывая насколько большие изменения мы делали, это был хороший опыт быстро получить обратную связь, найти баги (с кешированием), при этом снизив риски для большинства пользователей.</p>
<h2 class="anchor anchorWithStickyNavbar_CPg9" id=надежды-и-мечты>Надежды и мечты<a href=#надежды-и-мечты class=hash-link aria-label="Прямая ссылка на Надежды и мечты" title="Прямая ссылка на Надежды и мечты">​</a></h2>
<p>Что-бы достичь всех плюшек от того что graphql может нам дать, надо еще много что поменять - добавить мутации, подписки, массовые операции на уровне федерации. Все это требует работы с командами и евангелизм что-бы увеличить количество федерируемых сервисов.</p>
<p>Как только наш graphql API станет стабильным и достаточным для использования любыми пользователями, его можно выкатить в качестве второй версии нашего API. Для публикации впрочем понадобятся еще директивы для ограничения доступа к сущностям согласно <a href=https://oauth.net/2/scope/ target=_blank rel="noopener noreferrer">OAuth видимости</a> (для приложений из рынка) и согласно нашим <a href=https://www.pipedrive.com/en/pricing target=_blank rel="noopener noreferrer">продуктам</a>.</p>
<p>В самой schema-registry надо добавить отслеживание клиентов, связать ее gateway для получения аналитики трафика что-бы проще было понять какие поля можно удалять, надо добавить фильтрацию и подсветку сущностей в зависимости от директив цены и видимости, валидировать именование, хранить постоянные запросы (persisted query), публиковать историю изменений итоговой схемы для сторонних разработчиков.</p>
<p>Кроме того, поскольку у нас есть сервисы на go, еще непонятно как стоит делать внутренний трафик - стоит ли использовать GRPC из-за скорости и надежности, либо использовать независимые graphql эндпоинты, либо ставить централизованный внутренний gateway. Если GRPC лучше только из-за его бинарности, может мы можем написать библиотечку которая тоже упакует graphql данные с помощью <a href=https://msgpack.org/ target=_blank rel="noopener noreferrer">msgpack</a>?</p>
<p>Что касается внешнего мира, надеюсь Apollo со своим <a href="https://www.youtube.com/watch?v=MvHzOwdLb_o" target=_blank rel="noopener noreferrer">проектом Constellation</a> ускорят обработку запроса на Rust что-бы небыло этих 10% налога на производительность и смогут федерировать graphql сервисы без серьезных изменений последних.</p>
<p>Вобщем прекрасное время что-бы наслаждаться разработкой где уйма сложности!</div><footer class="row docusaurus-mt-lg"><div class=col><b>Теги:</b><ul class="tags_BNPU padding--none margin-left--sm"><li class=tag_wFKI><a class="tag_mxxo tagRegular_OVld" href=/blog/tags/backend>backend</a></ul></div></footer></article><article class=margin-bottom--xl><header><h2 class=title_Y5lg><a href="/blog/tech/backend/Шпаргалка по golang - часть 1">Шпаргалка по golang</a></h2><div class="container__LhH margin-vert--md"><time datetime=2018-04-18T10:00:00.000Z>18 апреля 2018 г.</time> · <!-- -->3 мин. чтения</div></header><div class=markdown><p><img decoding=async loading=lazy src="/assets/images/Pasted image 20241019193324-2e3bc176acc7171df381d8de660e89f2.png" width=1280 height=720 class=img_sJtY></p>
<p>После php и node начал писать на go, поэтому по-аналогии с unix-шпаргалкой, выпишу для себя основы..</p>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=запуск>Запуск<a href=#запуск class=hash-link aria-label="Прямая ссылка на Запуск" title="Прямая ссылка на Запуск">​</a></h3>
<p>go run main.go → компиляция и запуск exe<br>
<!-- -->go build main.go → только компиляция и создание exe, без запуска<br>
<!-- -->go get -u <a href=https://github.com/x/y target=_blank rel="noopener noreferrer">https://github.com/x/y</a> → импортирование зависимостей</p>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=переменные-и-типы>Переменные и типы<a href=#переменные-и-типы class=hash-link aria-label="Прямая ссылка на Переменные и типы" title="Прямая ссылка на Переменные и типы">​</a></h3>
<table><thead><tr><th><th><th><tbody><tr><td>тип<td>декларация<td>значение по умолчанию<tr><td>целые<td>int8, int 16, int32, int64, uint, uint64<td>0<tr><td>бинарные<td>byte<td><tr><td>бит<td>bool<td>false<tr><td>с плавающей точкой<td>float, float32, float64<td>0<tr><td>строка<td>string, rune<td>(пустая строка)</table>
<div class="language-go codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-go codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>var</span><span class="token plain"> i </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>10</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>var</span><span class="token plain"> myfirstvar</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> mysecondvar </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>3</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>4</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// объявление разом</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>var</span><span class="token plain"> autoInt </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>10</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// компилятор сам подберёт тип</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>var</span><span class="token plain"> mystring </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"test\n"</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// двойные для строк, всё в уникоде</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>var</span><span class="token plain"> mysymbol </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token char">'\u2318'</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// один символ</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>var</span><span class="token plain"> rawBinary </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token char">'\x27'</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// одинарные кавычки для символа</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">myNewDeclared </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>42</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// быстрая инициализация</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">myMathVar </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>7</span><span class="token operator" style=color:#393A34>+</span><span class="token number" style=color:#36acaa>3i</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// математикам</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=приведение-типов>Приведение типов<a href=#приведение-типов class=hash-link aria-label="Прямая ссылка на Приведение типов" title="Прямая ссылка на Приведение типов">​</a></h3>
<div class="language-go codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-go codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token function" style=color:#d73a49>int</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">myfloat</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>float64</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">myInt</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>string</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>48</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//будет номер символа, а не строчка "48"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">bin </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token function" style=color:#d73a49>byte</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">mystr</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//перевод строки в массив байтов для итерации по байтам</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=константа>Константа<a href=#константа class=hash-link aria-label="Прямая ссылка на Константа" title="Прямая ссылка на Константа">​</a></h3>
<div class="language-go codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-go codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> fullName </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Artjom"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>//объявление нескольких переменных с инкрементом</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> one </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>iota</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//iota начало итерации с нуля</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>_</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// пропуск "двойки"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> KB </span><span class="token builtin">uint64</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>&lt;&lt;</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>10</span><span class="token operator" style=color:#393A34>*</span><span class="token boolean" style=color:#36acaa>iota</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=массив>Массив<a href=#массив class=hash-link aria-label="Прямая ссылка на Массив" title="Прямая ссылка на Массив">​</a></h3>
<p>Низкоуровневый тип. Длина массива фиксирована.</p>
<div class="language-go codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-go codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>var</span><span class="token plain"> a1 </span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>3</span><span class="token punctuation" style=color:#393A34>]</span><span class="token builtin">int</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//длина массива, сразу заполнится [0 0 0]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>var</span><span class="token plain"> a1 </span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>2</span><span class="token operator" style=color:#393A34>*</span><span class="token plain">size</span><span class="token punctuation" style=color:#393A34>]</span><span class="token builtin">bool</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//длина зависит от перменной</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">a3</span><span class="token operator" style=color:#393A34>:=</span><span class="token punctuation" style=color:#393A34>[</span><span class="token operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>]</span><span class="token builtin">int</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>,</span><span class="token number" style=color:#36acaa>3</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//инициализирование значениями</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>var</span><span class="token plain"> aa</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>3</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>3</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//массив массивов</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>len</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">mystring</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//длина строк и массивов</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=слайс-резиновый-массив>Слайс (резиновый массив)<a href=#слайс-резиновый-массив class=hash-link aria-label="Прямая ссылка на Слайс (резиновый массив)" title="Прямая ссылка на Слайс (резиновый массив)">​</a></h3>
<p>Более сложная структура. Состоит из массива с фиксированной длиной (capacity) в которую записано меньшее количество элементов (length). Как только length превышает capacity, размер capacity удваивается</p>
<div class="language-go codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-go codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>var</span><span class="token plain"> s1 </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token builtin">int</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//без размера</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>100</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// добавление</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>len</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>cap</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// узнать capacity</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">s2</span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token function" style=color:#d73a49>int</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>,</span><span class="token number" style=color:#36acaa>3</span><span class="token punctuation" style=color:#393A34>,</span><span class="token number" style=color:#36acaa>4</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//создание со значениями</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">s1 </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token builtin">append</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> s2</span><span class="token operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//Соединение слайсов через оператор развёртывания значений</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">s3 </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>make</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token builtin">int</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>10</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//Создание слайса сразу нужной длины, значения уже будут заполнены</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">s4 </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>make</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token builtin">int</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>10</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>15</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// Создание слайса с нужной capacity</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>copy</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s7</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> s6</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// копирование значений, но размер целевого слайса должен совпадать</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Println</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"> s7</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>:</span><span class="token number" style=color:#36acaa>5</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// часть слайса</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// слайс из массива</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">a</span><span class="token operator" style=color:#393A34>:=</span><span class="token punctuation" style=color:#393A34>[</span><span class="token operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>]</span><span class="token function" style=color:#d73a49>int</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>5</span><span class="token punctuation" style=color:#393A34>,</span><span class="token number" style=color:#36acaa>6</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><br></span><span class=token-line style=color:#393A34><span class="token plain">b</span><span class="token operator" style=color:#393A34>:=</span><span class="token plain">a</span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>:</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//слайс теперь ссылается на массив</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=мап-ассоциативный-массив>Мап (ассоциативный массив)<a href=#мап-ассоциативный-массив class=hash-link aria-label="Прямая ссылка на Мап (ассоциативный массив)" title="Прямая ссылка на Мап (ассоциативный массив)">​</a></h3>
<div class="language-go codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-go codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>var</span><span class="token plain"> myEmptyMap </span><span class="token keyword" style=color:#00009f>map</span><span class="token punctuation" style=color:#393A34>[</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>]</span><span class="token builtin">string</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// [тип ключа] и тип данных, но пустой, в него нельзя писать</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>var</span><span class="token plain"> mm1 </span><span class="token keyword" style=color:#00009f>map</span><span class="token punctuation" style=color:#393A34>[</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>]</span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>map</span><span class="token punctuation" style=color:#393A34>[</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>]</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//пустой интерфейс</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">mm2 </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>map</span><span class="token punctuation" style=color:#393A34>[</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>]</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">mm3 </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>make</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>map</span><span class="token punctuation" style=color:#393A34>[</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>]</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">mm2</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"firstName"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Artjom"</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//write</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Println</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">mm2</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"firstName"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//read</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>delete</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">mm3</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"somekey"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//delete</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Println</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">mm3</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"nonexistingkey"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//выдаст значение по умолчанию (пустая строка)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token boolean" style=color:#36acaa>_</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> exists </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> mm3</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"missing"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// проверка есть ли такой ключ</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=ключевые-слова-в-управляющих-конструкциях>Ключевые слова в управляющих конструкциях<a href=#ключевые-слова-в-управляющих-конструкциях class=hash-link aria-label="Прямая ссылка на Ключевые слова в управляющих конструкциях" title="Прямая ссылка на Ключевые слова в управляющих конструкциях">​</a></h3>
<ul>
<li>
<p>fallthrough - проваливание в switch case</p>
</li>
<li>
<p>break - выход из  switch</p>
</li>
<li>
<p>range - итерирование по символам строки, например</p>
</li>
<li>
<p>for index﻿val := range mystr</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=функция>Функция<a href=#функция class=hash-link aria-label="Прямая ссылка на Функция" title="Прямая ссылка на Функция">​</a></h3>
<p>init() - вызывается при старте программы в любом из пакетов (порядок неконтролируемый)</p>
<div class="language-go codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-go codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>//аргументы передаются по значению</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>avg</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">x </span><span class="token builtin">int</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> float</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//возвращаемый тип в конце</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>multipleArgs</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">severalInts </span><span class="token operator" style=color:#393A34>...</span><span class="token builtin">int</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//развёртывание аргументов в слайс</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>avg2</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">y </span><span class="token builtin">int</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">res float</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//сокращение return res в конце</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    res </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>mysql</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">file File</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"> x</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    file</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>open</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>defer</span><span class="token plain"> file</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>close</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>//заранее объявляет что надо вызвать в конце исполнения функции</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>if</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">x</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>//do more lots of stuff</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>См. также</p>
<ul>
<li><a href=https://gobyexample.com/ target=_blank rel="noopener noreferrer">​Go by example</a></li>
<li><a href=https://tour.golang.org/list target=_blank rel="noopener noreferrer">Go tour</a></li>
<li><a href=https://github.com/golang/go/wiki/SliceTricks target=_blank rel="noopener noreferrer">Slice tricks</a></li>
</ul>
<iframe width=100% height=400 src=https://www.youtube.com/embed/9Pk7xAT_aCU title="1. Программирование на Go. Введение" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy=strict-origin-when-cross-origin></iframe></div><footer class="row docusaurus-mt-lg"><div class=col><b>Теги:</b><ul class="tags_BNPU padding--none margin-left--sm"><li class=tag_wFKI><a class="tag_mxxo tagRegular_OVld" href=/blog/tags/backend>backend</a></ul></div></footer></article><article class=margin-bottom--xl><header><h2 class=title_Y5lg><a href="/blog/tech/backend/Dashboard на основе Grafana и InfluxDB">Dashboard на основе Grafana и InfluxDB</a></h2><div class="container__LhH margin-vert--md"><time datetime=2017-12-25T10:00:00.000Z>25 декабря 2017 г.</time> · <!-- -->2 мин. чтения</div></header><div class=markdown><p>В продолжение темы умного дома где мой <a href=https://kurapov.ee/rus/technology/gadgets/smart_home_pellet_burner_RTB30/ target=_blank rel="noopener noreferrer">котёл умел выдавать API</a> для мониторинга температур, захотелось мне вывести эти данные в более приятный вид. Кроме того, хотя сам котёл умеет рисовать графики, он показывал на них только температурную зону одного контура, а мне хотелось видеть два.</p>
<p>Поэтому я решил поизучать бесплатный dashboard и графико-генератор на основе <a href=http://grafana.net/ target=_blank rel="noopener noreferrer">Grafana</a>. Зарегился и упёрся в то что он сам не хранит данные. Он умеет только подключаться к <strong>внешним источникам</strong> и делать запросы туда. </p>
<p>Новый MySQL мне не хотелось поднимать, а открывать существующий тем более. Cloudwatch от Амазона - видимо полезен для мониторинга сервисов если вы активно пользуетесь этой инфраструктурой. Prometheus я могу и на работе посмотреть. Выбрал InfluxDB - специальную БД для хранения временных событий.</p>
<p><a href=https://docs.influxdata.com/influxdb/v1.4/introduction/installation/ target=_blank rel="noopener noreferrer">Ставить Influx</a> было достаточно просто. Сложней было связать графану с influx.</p>
<p>Сервис гоняется на 8086 порту и Grafana хочет SSL и CORS. Поэтому пришлось делать proxy на nginx и добавлять header:</p>
<div class="codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-text codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token plain">location /influx/ {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    proxy_set_header HOST $host;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    proxy_set_header X-Forwarded-Proto $scheme;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header 'Access-Control-Allow-Credentials' 'true';</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    proxy_pass http://localhost:8086/;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Теперь встаёт вопрос как данные добавить в influx. Писать будет процесс на node, поэтому я по-быстрому нашёл библиотечку и пример подключения: </p>
<div class="language-js codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-js codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token maybe-class-name">Influx</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>require</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'influx'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> influx </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Influx</span><span class="token class-name punctuation" style=color:#393A34>.</span><span class="token class-name">InfluxDB</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">	</span><span class="token literal-property property" style=color:#36acaa>host</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'localhost'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">	</span><span class="token literal-property property" style=color:#36acaa>database</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'home'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">	</span><span class="token literal-property property" style=color:#36acaa>schema</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">		</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">			</span><span class="token literal-property property" style=color:#36acaa>measurement</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'response_times'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">			</span><span class="token literal-property property" style=color:#36acaa>fields</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">				</span><span class="token literal-property property" style=color:#36acaa>boiler_smoketemp</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">Influx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">FieldType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>FLOAT</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">				</span><span class="token literal-property property" style=color:#36acaa>boiler_output</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">Influx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">FieldType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>FLOAT</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">				</span><span class="token literal-property property" style=color:#36acaa>boiler_power</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">Influx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">FieldType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>FLOAT</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">				</span><span class="token literal-property property" style=color:#36acaa>boiler_light</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">Influx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">FieldType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>FLOAT</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">				</span><span class="token literal-property property" style=color:#36acaa>boiler_oxygen</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">Influx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">FieldType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>FLOAT</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">				</span><span class="token literal-property property" style=color:#36acaa>boiler_oxygenlow</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">Influx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">FieldType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>FLOAT</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">				</span><span class="token literal-property property" style=color:#36acaa>boiler_oxygenmid</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">Influx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">FieldType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>FLOAT</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">				</span><span class="token literal-property property" style=color:#36acaa>boiler_oxygenhigh</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">Influx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">FieldType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>FLOAT</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">				</span><span class="token literal-property property" style=color:#36acaa>boiler_connectionindex</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">Influx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">FieldType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>FLOAT</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">				</span><span class="token literal-property property" style=color:#36acaa>boiler_return</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">Influx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">FieldType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>FLOAT</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">				</span><span class="token literal-property property" style=color:#36acaa>zone_1</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">Influx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">FieldType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>FLOAT</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">				</span><span class="token literal-property property" style=color:#36acaa>zone_2</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">Influx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">FieldType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>FLOAT</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">			</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">			</span><span class="token literal-property property" style=color:#36acaa>tags</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">				</span><span class="token string" style=color:#e3116c>'host'</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">			</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">		</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">	</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>//заполняем data..</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">influx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>writePoints</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">	</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">		</span><span class="token literal-property property" style=color:#36acaa>measurement</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'heating'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">		</span><span class="token literal-property property" style=color:#36acaa>fields</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> data</span><br></span><span class=token-line style=color:#393A34><span class="token plain">	</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token keyword control-flow" style=color:#00009f>catch</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">	</span><span class="token console class-name">console</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>error</span><span class="token punctuation" style=color:#393A34>(</span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token template-string string" style=color:#e3116c>Error saving data to InfluxDB! </span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token template-string interpolation">err</span><span class="token template-string interpolation punctuation" style=color:#393A34>.</span><span class="token template-string interpolation property-access">stack</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Теперь что-бы проверить записались ли данные, можно использовать хронограф - скачиваемый UI-сервис который в более ранних версиях был встроен в influx в виде админ-панели.</p>
<p><img decoding=async loading=lazy src="/assets/images/Pasted image 20241016133602-4282ac478ccf1d138f4f4fc2f78efe1f.png" width=1322 height=1164 class=img_sJtY></p>
<p>Окей, данные плывут, теперь осталось совсем чуть-чуть что-бы они появились и в графане где можно будет подключить и другие источники данных тоже..</p>
<p><img decoding=async loading=lazy src="/assets/images/Pasted image 20241016133611-bdbc720d783f18d90ae5bad523a89875.png" width=2154 height=1566 class=img_sJtY></div><footer class="row docusaurus-mt-lg"><div class=col><b>Теги:</b><ul class="tags_BNPU padding--none margin-left--sm"><li class=tag_wFKI><a class="tag_mxxo tagRegular_OVld" href=/blog/tags/backend>backend</a></ul></div></footer></article><article class=margin-bottom--xl><header><h2 class=title_Y5lg><a href="/blog/tech/backend/Микросервисы 2">Микросервисы 2</a></h2><div class="container__LhH margin-vert--md"><time datetime=2017-07-06T10:00:00.000Z>6 июля 2017 г.</time> · <!-- -->3 мин. чтения</div></header><div class=markdown><p>В прошлой статье я начал изучать микросервисный подход, но до полноценного решения тогда не дошёл. Тогда я пробовал сам поднимать процессы на php, управлять ими, связывать между собой через очереди потому что монолит не мог справиться с асинхронными задачами. Но чего у меня реально нехватало, так это <strong>нормальной изоляции и деплоймента, межсервисного взаимодействия и стабильной работы</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=docker>Docker<a href=#docker class=hash-link aria-label="Прямая ссылка на Docker" title="Прямая ссылка на Docker">​</a></h3>
<p>Я сразу скажу что не знаю как настраивать production с докер-контейнерами, но сервисы в рабочем окружении поднимаются тривиально</p>
<ul>
<li>
<p>Ставите <a href=https://www.docker.com/products/docker-toolbox target=_blank rel="noopener noreferrer">Docker для Мака или для Windows</a></p>
</li>
<li>
<p>Ставите <a href=https://github.com/moncho/dry target=_blank rel="noopener noreferrer">dry</a> для терминала (по желанию)</p>
</li>
<li>
<p>Создаёте Dockerfile</p>
</li>
<li>
<p>Создаёте docker-compose.yml</p>
</li>
<li>
<p>Запускаете docker-compose up</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_CPg9" id=концепции>Концепции<a href=#концепции class=hash-link aria-label="Прямая ссылка на Концепции" title="Прямая ссылка на Концепции">​</a></h4>
<p><strong>Images (образы)</strong> это изолированная среда, как правило с конкретным языком (node, php) или библиотекой. За это отвечает <a href=https://docs.docker.com/engine/reference/builder/ target=_blank rel="noopener noreferrer">Dockerfile</a>, который ссылается на существующий, скачиваемый образ на докер хабе.</p>
<p>Что-бы увидеть установленные образы, есть комманда  <strong><strong>docker images</strong></strong> . </p>
<p><strong><strong>Контейнеры</strong></strong>  это запущенные образы которые изолированы от host-машины. Обычно контейнер поднимается для какого-то сервиса, поэтому у него есть своё название, явно объявлен маппинг сетевых портов на host-машину и способ монтирования файловой системы -  за это отвечает docker-compose.yml</p>
<p>Что-бы увидеть установленные образы, есть комманда  <strong><strong>docker images</strong></strong> . </p>
<p><strong><strong>Контейнеры</strong></strong>  это запущенные образы которые изолированы от host-машины. Обычно контейнер поднимается для какого-то сервиса, поэтому у него есть своё название, явно объявлен маппинг сетевых портов на host-машину и способ монтирования файловой системы -  за это отвечает docker-compose.yml</p>
<p>По умолчанию порт  <strong><strong>не перебрасываются на такой же</strong></strong> , а файлы хоста не линкуются и  <strong><strong>не будут обновляться внутри контейнера</strong></strong>  после старта.</p>
<p>Что-бы увидеть запущенные контейнеры, есть комманда  <strong><strong>docker ps</strong></strong>  (а лучше dry)</p>
<p>Что-бы запустить текущую папку есть  <strong><strong>docker-compose down && docker-compose up</strong></strong>  — это основная комманда которой вы будете пользоваться в разработке если будете делать изменения</p>
<p>Для автоматизации перезагрузки контейнера при изменении файлов на hostе, для node надо копать в сторону <a href=http://pm2.keymetrics.io/docs/usage/docker-pm2-nodejs/ target=_blank rel="noopener noreferrer">pm2-docker</a></p>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=consul>Consul<a href=#consul class=hash-link aria-label="Прямая ссылка на Consul" title="Прямая ссылка на Consul">​</a></h3>
<p>Консул это сервер, который служит для связывания сервисов воедино (service discovery), поддержания их состояния здоровья (healthcheck) и для их конфигурации без перезапуска (key-value storage)</p>
<p>Каждый поднимающийся сервис сам должен зарегистрировать себя в консуле, указать на каком IP/порте он работает. Сам должен открыть HTTP endpoint который будет выдавать состояние здоровья</p>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=сложности>Сложности<a href=#сложности class=hash-link aria-label="Прямая ссылка на Сложности" title="Прямая ссылка на Сложности">​</a></h3>
<p>При создании микросервисов самая сложная часть это <strong>граница</strong> и <strong>управление</strong>.  Сервис должен отвечать за конкретную бизнес-функцию и доменную область. Это вертикальный срез приложения.  Но при этом сервис должен выполнять весь стек работы — ui, backend, db storage, queue processor. Впихивать столько ответсвенности в один сервис технологически сложно, поэтому приходится дробить вертикальный стек ещё на несколько горизонтальных слоёв. Образно был article-manager - стал article-frontend, article-server, article-worker, над которыми нависают ещё всякие сервисы мониторинга. Это тяжело связывать вместе и деплоить разом.</p>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=node>Node<a href=#node class=hash-link aria-label="Прямая ссылка на Node" title="Прямая ссылка на Node">​</a></h3>
<p>Поскольку нода висит постоянно в памяти, в отличие от php, который запускается при запросе, то возникает проблема перезагрузки кода при его изменении. Вот как выглядит Dockerfile с PM2:</p>
<div class="codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-text codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token plain">FROM node:6-alpine</span><br></span><span class=token-line style=color:#393A34><span class="token plain">USER root</span><br></span><span class=token-line style=color:#393A34><span class="token plain">ENV PORT=3000</span><br></span><span class=token-line style=color:#393A34><span class="token plain">EXPOSE 3000</span><br></span><span class=token-line style=color:#393A34><span class="token plain">RUN npm install pm2 -g</span><br></span><span class=token-line style=color:#393A34><span class="token plain">WORKDIR /app</span><br></span><span class=token-line style=color:#393A34><span class="token plain">CMD ["pm2-docker", "start", "pm2.json", "--watch"]</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Теперь в pm2.json описывается при каком случае надо перезапускать докер сервис</p>
<div class="codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-text codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token plain">{</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  "apps": [</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      "name": "article-manager",</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      "script": "index.js",</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      "env": {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        "PORT": 3000,</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        "CONSUL_IP": "192.168.10.10",</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        "CONSUL_PORT": 8500,</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        "SERVICE_NAME": "article-manager"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      },</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      "watch": true,</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      "ignore_watch": [</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        "node_modules",</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        "npm-debug.log",</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        ".idea",</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        ".git",</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        "test/coverage"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      ],</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      "watch_options": {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        "followSymlinks": false</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  ]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=redis>Redis<a href=#redis class=hash-link aria-label="Прямая ссылка на Redis" title="Прямая ссылка на Redis">​</a></h3>
<p>Очень быстрая in-memory база для кеширования данных</p>
<div class="codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-text codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token plain">version: '2'</span><br></span><span class=token-line style=color:#393A34><span class="token plain">services:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  redis-master:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    image: 'redis:2.8'</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    network_mode: bridge</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    volumes:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        - ./data:/data</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ports:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        - 6379:6379</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    command: redis-server --appendonly yes</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_CPg9" id=alias>Alias<a href=#alias class=hash-link aria-label="Прямая ссылка на Alias" title="Прямая ссылка на Alias">​</a></h3>
<p>Для удобства, советую добавить в ваш ~/.bashrc или ~/.zshrc алиас на быстрое поднятие контейнера:</p>
<div class="codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-text codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token plain">alias doc='docker-compose down && docker-compose up'</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class=col><b>Теги:</b><ul class="tags_BNPU padding--none margin-left--sm"><li class=tag_wFKI><a class="tag_mxxo tagRegular_OVld" href=/blog/tags/backend>backend</a></ul></div></footer></article><article class=margin-bottom--xl><header><h2 class=title_Y5lg><a href="/blog/tech/backend/Создаём виртуальный образ ОС для среды разработки">Создаём виртуальный образ ОС для среды разработки</a></h2><div class="container__LhH margin-vert--md"><time datetime=2016-09-29T10:00:00.000Z>29 сентября 2016 г.</time> · <!-- -->2 мин. чтения</div></header><div class=markdown><p>В качестве основы, будем использовать CentOS 6.5</p>
<ul>
<li>Устанавливаем последние Virtualbox и <a href=https://www.vagrantup.com/downloads.html target=_blank rel="noopener noreferrer">Vagrant</a></li>
<li>Создаём новую виртуалку в virtualbox на основе федоры, поставив 2ГБ RAM и 20 GB под жёсткий диск</li>
<li>Скачиваем CentOS-6.5-x86_64-LiveCD.iso с <a href=http://mirror.nsc.liu.se/centos-store/6.5/isos/x86_64/ target=_blank rel="noopener noreferrer">http://mirror.nsc.liu.se/centos-store/6.5/isos/x86_64/</a>. Он включает мгновенный бут (загрузчик), recovery и установку</li>
<li>Ставим root'у пароль vagrant (потом сменить можно)</li>
<li>Добавляем стандартного пользователя vagrant<!-- -->:vagrant</li>
</ul>
<p>Обновляем систему:</p>
<div class="codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-text codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token plain">#dont update unless you want CentOS 6.8 upgrade</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#yum update -y</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">#install basic tools</span><br></span><span class=token-line style=color:#393A34><span class="token plain">yum install -y htop nano</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">#reboot for kernel updates to take place</span><br></span><span class=token-line style=color:#393A34><span class="token plain">shutdown -r now</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Систему надо <a href=https://blog.engineyard.com/2014/building-a-vagrant-box target=_blank rel="noopener noreferrer">настроить для вагранта</a>, если мы хотим её автоматически выкатывать под разные проекты..</p>
<p>Сначала - настроить пользователя</p>
<div class="codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-text codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token plain">sudo visudo -f /etc/sudoers.d/vagrant</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#adding to this file:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">vagrant ALL(ALL) NOPASSWD:ALL</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">#setup vagrant public key access</span><br></span><span class=token-line style=color:#393A34><span class="token plain">mkdir -p /home/vagrant/.ssh</span><br></span><span class=token-line style=color:#393A34><span class="token plain">chmod 0700 /home/vagrant/.ssh</span><br></span><span class=token-line style=color:#393A34><span class="token plain">wget --no-check-certificate \</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub \</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    -O /home/vagrant/.ssh/authorized_keys</span><br></span><span class=token-line style=color:#393A34><span class="token plain">chmod 0600 /home/vagrant/.ssh/authorized_keys</span><br></span><span class=token-line style=color:#393A34><span class="token plain">chown -R vagrant /home/vagrant/.ssh</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">nano /etc/ssh/sshd_config</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#uncomment  AuthorizedKeysFile %h/.ssh/authorized_keys</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">#enable public key authentication</span><br></span><span class=token-line style=color:#393A34><span class="token plain">service sshd restart</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">#start ssh on reboot</span><br></span><span class=token-line style=color:#393A34><span class="token plain">chkconfig sshd on</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">visudo #comment out requiretty option</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Теперь для вагранта нужны Guest Additions. Это iso файл который у virtual box'а уже есть. Надо смонтировать его на диск и запустить установку пакетов</p>
<div class="codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-text codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token plain">yum install -y gcc build-essential perl kernel-devel</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">#mount VBoxGuestAdditions.iso on CD in Virtualbox and run these:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">sudo mount /dev/cdrom /mnt </span><br></span><span class=token-line style=color:#393A34><span class="token plain">cd /mnt</span><br></span><span class=token-line style=color:#393A34><span class="token plain">sudo ./VBoxLinuxAdditions.run</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">echo export KERN_DIR=/usr/src/kernels/`uname -r`/ >> ~/.bashrc</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Теперь, у вас вероятно стоит надстройка для безопасности - SELinux. Если вы будете разрабатывать локально, то лучше его отключить</p>
<div class="codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-text codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token plain">setenforce Permissive</span><br></span><span class=token-line style=color:#393A34><span class="token plain">nano /etc/sysconfig/selinux</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#set to:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#SELINUX=disabled</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Теперь когда всё готово, выходим из виртуалки и упаковываем её для vagrant'а. Для этого надо зайти в папку где лежит виртуалка и запустить комманду которая сгенерит package.box файлик на который в дальнейшем будет ссылаться Vagrantfile в нашем проекте:</p>
<div class="codeBlockContainer__iiz theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_HaV9><pre tabindex=0 class="prism-code language-text codeBlock_ZL1J thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_qXKr><span class=token-line style=color:#393A34><span class="token plain">#package box and move it to desktop</span><br></span><span class=token-line style=color:#393A34><span class="token plain">vagrant package --base CentosEmpty && mv package.box ~/Desktop/</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">#clean vagrant cache</span><br></span><span class=token-line style=color:#393A34><span class="token plain">vagrant global-status --prune</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">#cd to your project that references new box from desktop</span><br></span><span class=token-line style=color:#393A34><span class="token plain">vagrant up</span><br></span></code></pre><div class=buttonGroup_Stij><button type=button aria-label="Скопировать в буфер обмена" title=Скопировать class=clean-btn><span class=copyButtonIcons_kDb_ aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_avy6><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_La4Y><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>См также:</p>
<p><a href=http://williamwalker.me/blog/creating-a-custom-vagrant-box.html target=_blank rel="noopener noreferrer">http://williamwalker.me/blog/creating-a-custom-vagrant-box.html</a><br>
<a href=https://www.vagrantup.com/docs/boxes/base.html target=_blank rel="noopener noreferrer">https://www.vagrantup.com/docs/boxes/base.html</a><br>
<a href=http://aruizca.com/steps-to-create-a-vagrant-base-box-with-ubuntu-14-04-desktop-gui-and-virtualbox/ target=_blank rel="noopener noreferrer">http://aruizca.com/steps-to-create-a-vagrant-base-box-with-ubuntu-14-04-desktop-gui-and-virtualbox/</a><a href=https://stefanwrobel.com/how-to-make-vagrant-performance-not-suck target=_blank rel="noopener noreferrer"></a><br>
<a href=https://stefanwrobel.com/how-to-make-vagrant-performance-not-suck target=_blank rel="noopener noreferrer">https://stefanwrobel.com/how-to-make-vagrant-performance-not-suck</a></p>
<p><a href=http://unix.stackexchange.com/questions/18435/how-to-install-virtualbox-guest-additions-on-centos-via-command-line-only target=_blank rel="noopener noreferrer">http://unix.stackexchange.com/questions/18435/how-to-install-virtualbox-guest-additions-on-centos-via-command-line-only</a></div><footer class="row docusaurus-mt-lg"><div class=col><b>Теги:</b><ul class="tags_BNPU padding--none margin-left--sm"><li class=tag_wFKI><a class="tag_mxxo tagRegular_OVld" href=/blog/tags/backend>backend</a></ul></div></footer></article><nav class=pagination-nav aria-label="Навигация по странице списка блогов"><a class="pagination-nav__link pagination-nav__link--next" href=/blog/tags/backend/page/2><div class=pagination-nav__label>Предыдущие записи</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>Media</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://twitter.com/tot_ra target=_blank rel="noopener noreferrer" class=footer__link-item>Short news on Twitter<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.youtube.com/user/artkurapov/ target=_blank rel="noopener noreferrer" class=footer__link-item>Long videos on Youtube<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.twitch.tv/tot_ra/ target=_blank rel="noopener noreferrer" class=footer__link-item>Streams on Twitch<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.instagram.com/tot_ra/ target=_blank rel="noopener noreferrer" class=footer__link-item>Nature on Instagram<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.tiktok.com/@artkurapov target=_blank rel="noopener noreferrer" class=footer__link-item>Short videos on TikTok<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>Business</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://www.linkedin.com/in/kurapov/ target=_blank rel="noopener noreferrer" class=footer__link-item>LinkedIn<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://github.com/tot-ra target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href="https://stackoverflow.com/users/158448/artjom-kurapov?tab=profile" target=_blank rel="noopener noreferrer" class=footer__link-item>Stack Overflow<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.slideshare.net/totra/presentations target=_blank rel="noopener noreferrer" class=footer__link-item>Slideshare<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://habr.com/ru/users/tot_ra/posts/ target=_blank rel="noopener noreferrer" class=footer__link-item>Habr<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://www.facebook.com/artkurapov target=_blank rel="noopener noreferrer" class=footer__link-item>Facebook<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://vk.com/artkurapov target=_blank rel="noopener noreferrer" class=footer__link-item>ВКонтакте<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.reddit.com/user/tot_ra/ target=_blank rel="noopener noreferrer" class=footer__link-item>Reddit<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://tot-ra.livejournal.com/ target=_blank rel="noopener noreferrer" class=footer__link-item>LiveJournal<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>Media</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://suno.com/@tot_ra target=_blank rel="noopener noreferrer" class=footer__link-item>Music on Suno<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://goodreads.com/tot_ra target=_blank rel="noopener noreferrer" class=footer__link-item>Books on Goodreads<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://steamcommunity.com/id/tot_ra/ target=_blank rel="noopener noreferrer" class=footer__link-item>Games on Steam<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://open.spotify.com/user/1176479585 target=_blank rel="noopener noreferrer" class=footer__link-item>Music on Spotify<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://soundcloud.com/tot_ra target=_blank rel="noopener noreferrer" class=footer__link-item>Music on Soundcloud<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.thingiverse.com/tot_ra/designs target=_blank rel="noopener noreferrer" class=footer__link-item>3D models on Thingiverse<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_gbbH><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2025</div></div></div></footer></div>