"use strict";(self.webpackChunkkurapov_ee=self.webpackChunkkurapov_ee||[]).push([["15938"],{73297:function(n,e,r){r.r(e),r.d(e,{assets:function(){return l},contentTitle:function(){return d},default:function(){return u},frontMatter:function(){return i},metadata:function(){return t},toc:function(){return s}});var t=r(98345),o=r(52676),a=r(22771);let i={title:"Drag-n-drop file upload",date:"2009-09-26T10:00",tags:["frontend"]},d=void 0,l={authorsImageUrls:[]},s=[{value:"Jquery dnd-upload",id:"jquery-dnd-upload",level:3}];function p(n){let e={a:"a",code:"code",h3:"h3",p:"p",pre:"pre",...(0,a.a)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.p,{children:"\u0441\u0443\u0431\u0431\u043E\u0442\u0430, 26 \u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044F 2009 \u0433. \u0432 22:21:16"}),"\n",(0,o.jsxs)(e.p,{children:["\u0412 \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0435\u043D\u0438\u0435 \u0441\u0442\u0430\u0442\u044C\u0438 \u043E\xa0",(0,o.jsx)(e.a,{href:"https://kurapov.ee/rus/technology/web/html5_intro/",children:"\u043D\u043E\u0432\u0438\u043D\u043A\u0430\u0445 \u0432 html5"}),", \u0432\u043E\u0442 \u043D\u0430\u0448\u0451\u043B\xa0",(0,o.jsx)(e.a,{href:"http://yehudab.com/apps/drag-n-drop/demo.html",children:"\u0434\u0435\u043C\u043E"}),"\xa0\u0433\u0434\u0435 \u0443\u0436\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0444\u0430\u0439\u043B\u043E\u0432 \u043E\u0431\u044B\u0447\u043D\u044B\u043C \u043F\u0435\u0440\u0435\u0442\u0430\u0441\u043A\u0438\u0432\u0430\u043D\u0438\u0435\u043C \u0432\xa0",(0,o.jsx)(e.a,{href:"http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/",children:"\u0431\u0440\u0430\u0443\u0437\u0435\u0440 Firefox 3.6"}),". \u041E\u0431\u044B\u0447\u043D\u044B\u0439 drag-n-drop \u0444\u0430\u0439\u043B\u043E\u0432 \u043F\u043E\u043A\u0430 \u0432 \u0441\u0442\u0430\u0431\u0438\u043B\u044C\u043D\u044B\u0445 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430\u0445\xa0",(0,o.jsx)(e.a,{href:"http://decafbad.com/blog/2009/07/15/html5-drag-and-drop",children:"\u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u043E \u0447\u0442\u043E \u043C\u043E\u0433\u0443\u0442"}),"\xa0\u2014 \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0441\u043E\u0431\u044B\u0442\u0438\u044F \u0430\u043D\u0430\u043B\u043E\u0433\u0438\u0447\u043D\u044B\u0435 \u043F\u0435\u0440\u0435\u0442\u0430\u0441\u043A\u0438\u0432\u0430\u043D\u0438\u044E dom-\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432 \u0432 \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0451\u043D\u043D\u044B\u0435 \u043A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440\u044B."]}),"\n",(0,o.jsx)(e.p,{children:"\u0415\u0441\u043B\u0438 \u0432\u0437\u0433\u043B\u044F\u043D\u0443\u0442\u044C \u0432 \u043A\u043E\u0434, \u0442\u043E \u043C\u043E\u0436\u043D\u043E \u0437\u0430\u043C\u0435\u0442\u0438\u0442\u044C \u0447\u0442\u043E \u0443 \u0441\u043E\u0431\u044B\u0442\u0438\u044F \u043F\u043E\u044F\u0432\u043B\u044F\u044E\u0442\u0441\u044F \u0442\u0430\u043A\u0438\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B \u0438 \u043C\u0435\u0442\u043E\u0434\u044B:"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.code,{children:"event.dataTransfer.files event.dataTransfer.mozTypesAt(0) event.dataTransfer.files[0].getAsBinary()"})}),"\n",(0,o.jsx)(e.p,{children:"\u0410 \u0434\u043B\u044F \u043E\u0442\u0441\u044B\u043B\u043A\u0438 \u0444\u0430\u0439\u043B\u0430 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u043E\u0431\u044B\u0447\u043D\u044B\u0439 \u0430\u044F\u043A\u0441\u043D\u044B\u0439 \u043E\u0431\u044A\u0435\u043A\u0442 \u0443 \u043A\u043E\u0442\u043E\u0440\u043E\u0433\u043E \u043F\u043E\u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u043C\u0435\u0442\u043E\u0434 sendAsBinary(). \u0412\u043E\u0431\u0449\u0435\u043C \u043F\u043E\u043A\u0430 \u044D\u0442\u043E \u0432\u044B\u0433\u043B\u044F\u0434\u0438\u0442 \u043A\u0430\u043A \u0445\u0430\u043A \u0438 \u0432\u0438\u0434\u0438\u043C\u043E \u0447\u0442\u043E \u043D\u0430\u0434\u043E \u0431\u043E\u043B\u044C\u0448\u0435 \u0432\u043D\u0438\u043C\u0430\u043D\u0438\u044F \u0443\u0434\u0435\u043B\u0438\u0442\u044C \u0441\u043F\u0435\u0446\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u0438 html5, \u0447\u0442\u043E-\u0431\u044B \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C \u0441\u043B\u0443\u0447\u0430\u0439\u043D\u043E \u043D\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u043B \u0432\u0435\u0441\u044C C:\\Windows, \u0447\u0442\u043E-\u0431\u044B \u043C\u043E\u0436\u043D\u043E \u0431\u044B\u043B\u043E \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E \u043E\u0442\u043B\u043E\u0436\u0438\u0442\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0443 \u0438\u043B\u0438 \u043E\u0442\u0444\u0438\u043B\u044C\u0442\u0440\u043E\u0432\u0430\u0442\u044C \u0447\u0442\u043E \u043A\u043E\u043D\u043A\u0440\u0435\u0442\u043D\u043E \u043D\u0430\u0434\u043E \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044C, \u0438\u043B\u0438 \u0434\u043E \u043A\u0430\u043A\u043E\u0439 \u0433\u043B\u0443\u0431\u0438\u043D\u044B \u043D\u0430\u0434\u043E \u0441\u0442\u0440\u0443\u043A\u0442\u0443\u0440\u0443 \u043F\u043E\u0434\u0433\u0440\u0443\u0436\u0430\u0442\u044C \u0438 \u043A\u0430\u043A \u043E\u0431\u0440\u0430\u0431\u0430\u0442\u044B\u0432\u0430\u0442\u044C."}),"\n",(0,o.jsx)(e.h3,{id:"jquery-dnd-upload",children:"Jquery dnd-upload"}),"\n",(0,o.jsx)(e.p,{children:"\u041D\u0430\u043F\u0438\u0441\u0430\u043B \u0434\u0432\u0430 jquery-\u043F\u043B\u0430\u0433\u0438\u043D\u0430 - \u043E\u0434\u0438\u043D \u0434\u043B\u044F \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u043A\u0438 Firefox 3.6 (Namoroka) HTML5 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438, \u0434\u0440\u0443\u0433\u043E\u0439 \u0434\u043B\u044F \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u043A\u0438 Google gears. \u041C\u043E\u0436\u043D\u043E \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u043E\u0431\u0430 \u0432\u043C\u0435\u0441\u0442\u0435.."}),"\n",(0,o.jsx)(e.p,{children:"\u0421\u0430\u043C\u044B\u0439 \u043F\u0440\u043E\u0441\u0442\u043E\u0439 \u0432\u0430\u0440\u0438\u0430\u043D\u0442 \u0434\u043B\u044F gears:"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.code,{children:"$('#drop_area').uploadg({gate:'http://somesite.com/upload_here_path/'});"})}),"\n",(0,o.jsx)(e.p,{children:"\u0417\u0430\u043C\u0435\u0442\u044C\u0442\u0435 \u0447\u0442\u043E \u043A\u043B\u044E\u0447 \u043F\u043E\u043B\u0443\u0447\u0430\u0435\u043C\u043E\u0433\u043E \u0443 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0444\u0430\u0439\u043B\u0430 \u0431\u0443\u0434\u0435\u0442 \"file\" (\u0432 \u043F\u0445\u043F \u0441\u043E\u043E\u0442\u0432\u0435\u0442\u0441\u0432\u0435\u043D\u043D\u043E $_FILES['file']).\xa0\u0410 \u0432\u043E\u0442 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u043D\u044B\u0439 \u043F\u0440\u0438\u043C\u0435\u0440 \u043A\u043E\u0434\u0430 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u0438.."}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.code,{children:"var dragndropConfig={ beforeLoad:function(){ this.gate=some_dynamic_file_upload_url+'?parentID='+SomeOtherDynamicObject.ID; if(SomeDisableReason){\xa0 this.can_proceed=false; } }, onProgress:function(event) { if (event.lengthComputable) { var percentage = Math.round((event.loaded * 100) / event.total); if (percentage &lt; 100) {\xa0 $('#some_progress_div').html('Uploading file..'+percentage+'%'); } } }, onComplete:function(event,txt) { $('#some_progress_div').html('done');\xa0 } }; if (window.google && google.gears){ $('#drop_area').uploadg(dragndropConfig); } else{ $('#drop_area').upload5(dragndropConfig); }"})}),"\n",(0,o.jsxs)(e.p,{children:["\u041E\u0441\u0442\u043E\u0440\u043E\u0436\u043D\u043E, Google gears \u0432\u0441\u0451 \u0435\u0449\u0451\xa0",(0,o.jsx)(e.a,{href:"http://groups.google.com/group/gears-users/browse_thread/thread/f6036bcc4a22cba5",children:"\u0438\u043C\u0435\u044E\u0442 \u0431\u0430\u0433\u0438"}),"\xa0\u0441\u0432\u044F\u0437\u0430\u043D\u043D\u044B\u0435 \u0441 \u0442\u0430\u043A\u043E\u0439 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u043E\u0439."]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-javascript",children:"/**\n * HTML5 drag and drop file jquery file uploading\n *\n * @author Artjom Kurapov <artkurapov@gmail.com>\n **/\n$.upload5=function(input, opt){\n	var ME=this;\n	ME.option = {\n		gate:'',\n		can_proceed:true,\n		\n		dragEnterColor:'#ffc',\n		dragExitColor:'#fff',\n		\n		beforeLoad:function() {},\n		onProgress:function(event) {},\n		onComplete:function(event) {}\n	};\n\n	if(typeof(opt)=='string'){\n		opt={'gate':opt};\n	}\n	\n	ME.option = $.extend(this.option,opt);\n\n	 \n	ME.upload = function (event) {\n		\n		event.stopPropagation();\n		event.preventDefault();\n        \n		ME.option.beforeLoad();\n		if(!ME.option.can_proceed){\n			return false;\n		}\n		\n		var data = event.dataTransfer;\n		\n        /*\n        for (var i = 0; i < data.files.length; i++) {\n            $('#image_list').prepend($('<img src=\"img/spinner.gif\" width=\"16\" height=\"16\" />').css(\"padding\", \"33px\"));\n        }\n        */\n        \n        var boundary = '------multipartformboundary' + (new Date).getTime();\n        var dashdash = '--';\n        var crlf     = '\\r\\n';\n\n        /* Build RFC2388 string. */\n        var builder = '';\n\n        builder += dashdash;\n        builder += boundary;\n        builder += crlf;\n        \n        var xhr = new XMLHttpRequest()    \n\n        \n		xhr.upload.addEventListener(\"progress\", ME.option.onProgress, false);\n			\n        xhr.open(\"POST\", ME.option.gate, true);\n        \n        if($.browser.safari){\n        	var formData = new FormData(); \n        	formData.append(\"file\", data.files.item()); \n        	xhr.send(formData);\n        }\n        else{\n        	\n		\n		    for (var i = 0; i < data.files.length; i++) {\n		        var file = data.files[i];\n		\n		        /* Generate headers. */            \n		        builder += 'Content-Disposition: form-data; name=\"file[]\"';\n		        if (file.fileName) {\n		          builder += '; filename=\"' + file.fileName + '\"';\n		        }\n		        builder += crlf;\n		\n		        builder += 'Content-Type: application/octet-stream';\n		        builder += crlf;\n		        builder += crlf; \n		\n		        /* Append binary data. */\n		        builder += file.getAsBinary();\n		        builder += crlf;\n		\n		        /* Write boundary. */\n		        builder += dashdash;\n		        builder += boundary;\n		        builder += crlf;\n		    }\n		\n		    \n		    /* Mark end of the request. */\n		    builder += dashdash;\n		    builder += boundary;\n		    builder += dashdash;\n		    builder += crlf;\n		    \n        	xhr.setRequestHeader('content-type', 'multipart/form-data; boundary=' + boundary);\n	        \n	        try{\n	        	xhr.sendAsBinary(builder);        \n	        }\n	        catch(err){\n	        	Note.set('error',t(\"Upload failed - use only latin-encoded filenames\"),13);\n	        	return false;\n	        }\n        }\n        \n        xhr.onload = function(event){\n        	ME.option.onComplete(event,xhr.responseText);\n        };\n    }\n			\n	$(input).get(0).addEventListener('drop', ME.upload, false);\n	\n    $(input).get(0).addEventListener('dragenter',	function(event) { \n    	$(input).css(\"background-color\", ME.option.dragEnterColor); \n    	event.stopPropagation();\n    	event.preventDefault();\n    }, false);\n    \n    $(input).get(0).addEventListener('dragover',	function(event) { \n    	$(input).css(\"background-color\", ME.option.dragEnterColor); \n    	event.stopPropagation();\n    	event.preventDefault();\n    }, false);\n    \n    $(input).get(0).addEventListener('dragexit', 	function(event) { $(input).css(\"background-color\", ME.option.dragExitColor); }, false);\n      \n	return ME;\n}\n\n$.fn.upload5 = function upload5(options){\n	this.each(function() {\n		var input = this;\n		new jQuery.upload5(input, options);\n	});\n	\n	return this;\n};\n"})})]})}function u(n={}){let{wrapper:e}={...(0,a.a)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(p,{...n})}):p(n)}},22771:function(n,e,r){r.d(e,{Z:function(){return d},a:function(){return i}});var t=r(75271);let o={},a=t.createContext(o);function i(n){let e=t.useContext(a);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:i(n.components),t.createElement(a.Provider,{value:e},n.children)}},98345:function(n){n.exports=JSON.parse('{"permalink":"/blog/tech/frontend/Drag-n-drop file upload","editUrl":"https://github.com/tot-ra/kurapov.ee/tree/main/blog/tech/frontend/Drag-n-drop file upload.md","source":"@site/blog/tech/frontend/Drag-n-drop file upload.md","title":"Drag-n-drop file upload","description":"\u0441\u0443\u0431\u0431\u043E\u0442\u0430, 26 \u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044F 2009 \u0433. \u0432 2216","date":"2009-09-26T10:00:00.000Z","tags":[{"inline":true,"label":"frontend","permalink":"/blog/tags/frontend"}],"readingTime":2.585,"hasTruncateMarker":false,"authors":[],"frontMatter":{"title":"Drag-n-drop file upload","date":"2009-09-26T10:00","tags":["frontend"]},"unlisted":false,"prevItem":{"title":"PHP frameworks","permalink":"/blog/tech/backend/php/PHP frameworks"},"nextItem":{"title":"League of legends","permalink":"/blog/\u0438\u0433\u0440\u044B/League of legends"}}')}}]);