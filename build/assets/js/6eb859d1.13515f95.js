"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[41245],{17126:(t,n,e)=>{e.r(n),e.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>d,toc:()=>s});var r=e(74848),o=e(28453);const a={},i=void 0,d={permalink:"/blog/tech/frontend/Drag-n-drop file upload",editUrl:"https://github.com/tot-ra/kurapov.ee/tree/main/blog/tech/frontend/Drag-n-drop file upload.md",source:"@site/blog/tech/frontend/Drag-n-drop file upload.md",title:"tech/frontend/Drag-n-drop file upload",description:"\u0441\u0443\u0431\u0431\u043e\u0442\u0430, 26 \u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f 2009 \u0433. \u0432 2216",date:"2024-10-22T20:50:17.978Z",tags:[],readingTime:2.585,hasTruncateMarker:!1,authors:[],frontMatter:{},unlisted:!1,prevItem:{title:"tech/frontend/Post form \u0441 window.open",permalink:"/blog/tech/frontend/Post form \u0441 window.open"},nextItem:{title:"tech/frontend/Datasync \u043c\u0435\u0436\u0434\u0443 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430\u043c\u0438",permalink:"/blog/tech/frontend/Datasync \u043c\u0435\u0436\u0434\u0443 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430\u043c\u0438"}},l={authorsImageUrls:[]},s=[{value:"Jquery dnd-upload",id:"jquery-dnd-upload",level:3}];function p(t){const n={a:"a",code:"code",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...t.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"\u0441\u0443\u0431\u0431\u043e\u0442\u0430, 26 \u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f 2009 \u0433. \u0432 22:21:16"}),"\n",(0,r.jsxs)(n.p,{children:["\u0412 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0435 \u0441\u0442\u0430\u0442\u044c\u0438 \u043e\xa0",(0,r.jsx)(n.a,{href:"https://kurapov.ee/rus/technology/web/html5_intro/",children:"\u043d\u043e\u0432\u0438\u043d\u043a\u0430\u0445 \u0432 html5"}),", \u0432\u043e\u0442 \u043d\u0430\u0448\u0451\u043b\xa0",(0,r.jsx)(n.a,{href:"http://yehudab.com/apps/drag-n-drop/demo.html",children:"\u0434\u0435\u043c\u043e"}),"\xa0\u0433\u0434\u0435 \u0443\u0436\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u043e\u0432 \u043e\u0431\u044b\u0447\u043d\u044b\u043c \u043f\u0435\u0440\u0435\u0442\u0430\u0441\u043a\u0438\u0432\u0430\u043d\u0438\u0435\u043c \u0432\xa0",(0,r.jsx)(n.a,{href:"http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/",children:"\u0431\u0440\u0430\u0443\u0437\u0435\u0440 Firefox 3.6"}),". \u041e\u0431\u044b\u0447\u043d\u044b\u0439 drag-n-drop \u0444\u0430\u0439\u043b\u043e\u0432 \u043f\u043e\u043a\u0430 \u0432 \u0441\u0442\u0430\u0431\u0438\u043b\u044c\u043d\u044b\u0445 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430\u0445\xa0",(0,r.jsx)(n.a,{href:"http://decafbad.com/blog/2009/07/15/html5-drag-and-drop",children:"\u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0447\u0442\u043e \u043c\u043e\u0433\u0443\u0442"}),"\xa0\u2014 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u044b\u0435 \u043f\u0435\u0440\u0435\u0442\u0430\u0441\u043a\u0438\u0432\u0430\u043d\u0438\u044e dom-\u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0432 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0451\u043d\u043d\u044b\u0435 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u044b."]}),"\n",(0,r.jsx)(n.p,{children:"\u0415\u0441\u043b\u0438 \u0432\u0437\u0433\u043b\u044f\u043d\u0443\u0442\u044c \u0432 \u043a\u043e\u0434, \u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0437\u0430\u043c\u0435\u0442\u0438\u0442\u044c \u0447\u0442\u043e \u0443 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043f\u043e\u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0442\u0430\u043a\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0438 \u043c\u0435\u0442\u043e\u0434\u044b:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"event.dataTransfer.files event.dataTransfer.mozTypesAt(0) event.dataTransfer.files[0].getAsBinary()"})}),"\n",(0,r.jsx)(n.p,{children:"\u0410 \u0434\u043b\u044f \u043e\u0442\u0441\u044b\u043b\u043a\u0438 \u0444\u0430\u0439\u043b\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043e\u0431\u044b\u0447\u043d\u044b\u0439 \u0430\u044f\u043a\u0441\u043d\u044b\u0439 \u043e\u0431\u044a\u0435\u043a\u0442 \u0443 \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u043f\u043e\u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043c\u0435\u0442\u043e\u0434 sendAsBinary(). \u0412\u043e\u0431\u0449\u0435\u043c \u043f\u043e\u043a\u0430 \u044d\u0442\u043e \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u043a\u0430\u043a \u0445\u0430\u043a \u0438 \u0432\u0438\u0434\u0438\u043c\u043e \u0447\u0442\u043e \u043d\u0430\u0434\u043e \u0431\u043e\u043b\u044c\u0448\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u044f \u0443\u0434\u0435\u043b\u0438\u0442\u044c \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 html5, \u0447\u0442\u043e-\u0431\u044b \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u043e \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u043b \u0432\u0435\u0441\u044c C:\\Windows, \u0447\u0442\u043e-\u0431\u044b \u043c\u043e\u0436\u043d\u043e \u0431\u044b\u043b\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043e\u0442\u043b\u043e\u0436\u0438\u0442\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0443 \u0438\u043b\u0438 \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0447\u0442\u043e \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e \u043d\u0430\u0434\u043e \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c, \u0438\u043b\u0438 \u0434\u043e \u043a\u0430\u043a\u043e\u0439 \u0433\u043b\u0443\u0431\u0438\u043d\u044b \u043d\u0430\u0434\u043e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 \u043f\u043e\u0434\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0438 \u043a\u0430\u043a \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0442\u044c."}),"\n",(0,r.jsx)(n.h3,{id:"jquery-dnd-upload",children:"Jquery dnd-upload"}),"\n",(0,r.jsx)(n.p,{children:"\u041d\u0430\u043f\u0438\u0441\u0430\u043b \u0434\u0432\u0430 jquery-\u043f\u043b\u0430\u0433\u0438\u043d\u0430 - \u043e\u0434\u0438\u043d \u0434\u043b\u044f \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438 Firefox 3.6 (Namoroka) HTML5 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438, \u0434\u0440\u0443\u0433\u043e\u0439 \u0434\u043b\u044f \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438 Google gears. \u041c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u0430 \u0432\u043c\u0435\u0441\u0442\u0435.."}),"\n",(0,r.jsx)(n.p,{children:"\u0421\u0430\u043c\u044b\u0439 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u0434\u043b\u044f gears:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"$('#drop_area').uploadg({gate:'http://somesite.com/upload_here_path/'});"})}),"\n",(0,r.jsx)(n.p,{children:"\u0417\u0430\u043c\u0435\u0442\u044c\u0442\u0435 \u0447\u0442\u043e \u043a\u043b\u044e\u0447 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u043c\u043e\u0433\u043e \u0443 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0444\u0430\u0439\u043b\u0430 \u0431\u0443\u0434\u0435\u0442 \"file\" (\u0432 \u043f\u0445\u043f \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0432\u0435\u043d\u043d\u043e $_FILES['file']).\xa0\u0410 \u0432\u043e\u0442 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u043d\u044b\u0439 \u043f\u0440\u0438\u043c\u0435\u0440 \u043a\u043e\u0434\u0430 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438.."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"var dragndropConfig={ beforeLoad:function(){ this.gate=some_dynamic_file_upload_url+'?parentID='+SomeOtherDynamicObject.ID; if(SomeDisableReason){\xa0 this.can_proceed=false; } }, onProgress:function(event) { if (event.lengthComputable) { var percentage = Math.round((event.loaded * 100) / event.total); if (percentage &lt; 100) {\xa0 $('#some_progress_div').html('Uploading file..'+percentage+'%'); } } }, onComplete:function(event,txt) { $('#some_progress_div').html('done');\xa0 } }; if (window.google && google.gears){ $('#drop_area').uploadg(dragndropConfig); } else{ $('#drop_area').upload5(dragndropConfig); }"})}),"\n",(0,r.jsxs)(n.p,{children:["\u041e\u0441\u0442\u043e\u0440\u043e\u0436\u043d\u043e, Google gears \u0432\u0441\u0451 \u0435\u0449\u0451\xa0",(0,r.jsx)(n.a,{href:"http://groups.google.com/group/gears-users/browse_thread/thread/f6036bcc4a22cba5",children:"\u0438\u043c\u0435\u044e\u0442 \u0431\u0430\u0433\u0438"}),"\xa0\u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0441 \u0442\u0430\u043a\u043e\u0439 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u043e\u0439."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"/**\n * HTML5 drag and drop file jquery file uploading\n *\n * @author Artjom Kurapov <artkurapov@gmail.com>\n **/\n$.upload5=function(input, opt){\n\tvar ME=this;\n\tME.option = {\n\t\tgate:'',\n\t\tcan_proceed:true,\n\t\t\n\t\tdragEnterColor:'#ffc',\n\t\tdragExitColor:'#fff',\n\t\t\n\t\tbeforeLoad:function() {},\n\t\tonProgress:function(event) {},\n\t\tonComplete:function(event) {}\n\t};\n\n\tif(typeof(opt)=='string'){\n\t\topt={'gate':opt};\n\t}\n\t\n\tME.option = $.extend(this.option,opt);\n\n\t \n\tME.upload = function (event) {\n\t\t\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n        \n\t\tME.option.beforeLoad();\n\t\tif(!ME.option.can_proceed){\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tvar data = event.dataTransfer;\n\t\t\n        /*\n        for (var i = 0; i < data.files.length; i++) {\n            $('#image_list').prepend($('<img src=\"img/spinner.gif\" width=\"16\" height=\"16\" />').css(\"padding\", \"33px\"));\n        }\n        */\n        \n        var boundary = '------multipartformboundary' + (new Date).getTime();\n        var dashdash = '--';\n        var crlf     = '\\r\\n';\n\n        /* Build RFC2388 string. */\n        var builder = '';\n\n        builder += dashdash;\n        builder += boundary;\n        builder += crlf;\n        \n        var xhr = new XMLHttpRequest()    \n\n        \n\t\txhr.upload.addEventListener(\"progress\", ME.option.onProgress, false);\n\t\t\t\n        xhr.open(\"POST\", ME.option.gate, true);\n        \n        if($.browser.safari){\n        \tvar formData = new FormData(); \n        \tformData.append(\"file\", data.files.item()); \n        \txhr.send(formData);\n        }\n        else{\n        \t\n\t\t\n\t\t    for (var i = 0; i < data.files.length; i++) {\n\t\t        var file = data.files[i];\n\t\t\n\t\t        /* Generate headers. */            \n\t\t        builder += 'Content-Disposition: form-data; name=\"file[]\"';\n\t\t        if (file.fileName) {\n\t\t          builder += '; filename=\"' + file.fileName + '\"';\n\t\t        }\n\t\t        builder += crlf;\n\t\t\n\t\t        builder += 'Content-Type: application/octet-stream';\n\t\t        builder += crlf;\n\t\t        builder += crlf; \n\t\t\n\t\t        /* Append binary data. */\n\t\t        builder += file.getAsBinary();\n\t\t        builder += crlf;\n\t\t\n\t\t        /* Write boundary. */\n\t\t        builder += dashdash;\n\t\t        builder += boundary;\n\t\t        builder += crlf;\n\t\t    }\n\t\t\n\t\t    \n\t\t    /* Mark end of the request. */\n\t\t    builder += dashdash;\n\t\t    builder += boundary;\n\t\t    builder += dashdash;\n\t\t    builder += crlf;\n\t\t    \n        \txhr.setRequestHeader('content-type', 'multipart/form-data; boundary=' + boundary);\n\t        \n\t        try{\n\t        \txhr.sendAsBinary(builder);        \n\t        }\n\t        catch(err){\n\t        \tNote.set('error',t(\"Upload failed - use only latin-encoded filenames\"),13);\n\t        \treturn false;\n\t        }\n        }\n        \n        xhr.onload = function(event){\n        \tME.option.onComplete(event,xhr.responseText);\n        };\n    }\n\t\t\t\n\t$(input).get(0).addEventListener('drop', ME.upload, false);\n\t\n    $(input).get(0).addEventListener('dragenter',\tfunction(event) { \n    \t$(input).css(\"background-color\", ME.option.dragEnterColor); \n    \tevent.stopPropagation();\n    \tevent.preventDefault();\n    }, false);\n    \n    $(input).get(0).addEventListener('dragover',\tfunction(event) { \n    \t$(input).css(\"background-color\", ME.option.dragEnterColor); \n    \tevent.stopPropagation();\n    \tevent.preventDefault();\n    }, false);\n    \n    $(input).get(0).addEventListener('dragexit', \tfunction(event) { $(input).css(\"background-color\", ME.option.dragExitColor); }, false);\n      \n\treturn ME;\n}\n\n$.fn.upload5 = function upload5(options){\n\tthis.each(function() {\n\t\tvar input = this;\n\t\tnew jQuery.upload5(input, options);\n\t});\n\t\n\treturn this;\n};\n"})})]})}function u(t={}){const{wrapper:n}={...(0,o.R)(),...t.components};return n?(0,r.jsx)(n,{...t,children:(0,r.jsx)(p,{...t})}):p(t)}},28453:(t,n,e)=>{e.d(n,{R:()=>i,x:()=>d});var r=e(96540);const o={},a=r.createContext(o);function i(t){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof t?t(n):{...n,...t}}),[n,t])}function d(t){let n;return n=t.disableParentContext?"function"==typeof t.components?t.components(o):t.components||o:i(t.components),r.createElement(a.Provider,{value:n},t.children)}}}]);