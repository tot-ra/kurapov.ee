"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[91386],{19743:(t,n,e)=>{e.r(n),e.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>c,toc:()=>a});var r=e(74848),s=e(28453);const o={},i=void 0,c={permalink:"/blog/testing/\u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u0442\u0435\u0441\u0442\u044b \u043d\u0430 \u0434\u0435\u0434\u043b\u043e\u043a\u0438 \u0438 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b",editUrl:"https://github.com/tot-ra/kurapov.ee/tree/main/blog/testing/\u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u0442\u0435\u0441\u0442\u044b \u043d\u0430 \u0434\u0435\u0434\u043b\u043e\u043a\u0438 \u0438 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b.md",source:"@site/blog/testing/\u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u0442\u0435\u0441\u0442\u044b \u043d\u0430 \u0434\u0435\u0434\u043b\u043e\u043a\u0438 \u0438 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b.md",title:"testing/\u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u0442\u0435\u0441\u0442\u044b \u043d\u0430 \u0434\u0435\u0434\u043b\u043e\u043a\u0438 \u0438 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b",description:"\u0447\u0435\u0442\u0432\u0435\u0440\u0433, 13 \u043e\u043a\u0442\u044f\u0431\u0440\u044f 2016 \u0433. \u0432 1752",date:"2024-10-22T20:50:18.261Z",tags:[],readingTime:1.905,hasTruncateMarker:!1,authors:[],frontMatter:{},unlisted:!1,prevItem:{title:"testing/\u041c\u043e\u043a\u0438 \u0432 \u044e\u043d\u0438\u0442-\u0442\u0435\u0441\u0442\u0430\u0445",permalink:"/blog/testing/\u041c\u043e\u043a\u0438 \u0432 \u044e\u043d\u0438\u0442-\u0442\u0435\u0441\u0442\u0430\u0445"},nextItem:{title:"testing/\u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u0442\u0435\u0441\u0442\u044b \u0441 \u0437\u0430\u0433\u043e\u0442\u043e\u0432\u043b\u0435\u043d\u043d\u043e\u0439 \u0411\u0414",permalink:"/blog/testing/\u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u0442\u0435\u0441\u0442\u044b \u0441 \u0437\u0430\u0433\u043e\u0442\u043e\u0432\u043b\u0435\u043d\u043d\u043e\u0439 \u0411\u0414"}},l={authorsImageUrls:[]},a=[];function u(t){const n={a:"a",code:"code",p:"p",pre:"pre",...(0,s.R)(),...t.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"\u0447\u0435\u0442\u0432\u0435\u0440\u0433, 13 \u043e\u043a\u0442\u044f\u0431\u0440\u044f 2016 \u0433. \u0432 17:11:52"}),"\n",(0,r.jsx)(n.p,{children:"\u0415\u0441\u043b\u0438 \u0432\u044b \u0442\u0430\u043a \u0436\u0435 \u043e\u0437\u0430\u0431\u043e\u0447\u0435\u043d\u044b \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u043a\u0430\u043a \u0438 \u044f, \u0442\u043e \u0432\u044b \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0441\u0442\u0430\u043b\u043a\u0438\u0432\u0430\u043b\u0438\u0441\u044c \u0441 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430\u043c\u0438 \u0434\u0435\u0434\u043b\u043e\u043a\u043e\u0432 \u043f\u0440\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f\u0445.\xa0\u0422\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u0432 \u0411\u0414 \u0434\u0435\u043b\u043e \u0445\u043e\u0440\u043e\u0448\u0435\u0435, \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e \u043d\u0430 \u0432\u0441\u0435 REST-\u0437\u0430\u043f\u0440\u043e\u0441\u044b, \u0442.\u043a. \u043e\u043d \u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0441\u044f \u0430\u0442\u043e\u043c\u0430\u0440\u043d\u043e\u0439 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0435\u0439. \u041e\u0434\u043d\u0430\u043a\u043e \u0435\u0441\u043b\u0438 \u0432\u044b \u0432\u043c\u0435\u0441\u0442\u0435 \u0441 \u044d\u0442\u0438\u043c \u0437\u0430\u0442\u0440\u0430\u0433\u0438\u0432\u0430\u0435\u0442\u0435 \u0447\u0430\u0441\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u0443\u044e \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u0438\u043b\u0438 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044f \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u043d\u0430 \u0444\u0430\u0439\u043b\u0430\u0445 \u0438\u043b\u0438 \u0441 \u0434\u0440\u0443\u0433\u0438\u043c\u0438 \u0441\u0435\u0442\u0435\u0432\u044b\u043c\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430\u043c\u0438, \u0442\u043e \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0432\u044b\u0437\u0432\u0430\u0442\u044c \u0434\u0435\u0434\u043b\u043e\u043a.\xa0"}),"\n",(0,r.jsxs)(n.p,{children:["MySQL/InnoDB \u0434\u0435\u0434\u043b\u043e\u043a \u0432\u043e\u0437\u043d\u0438\u043a\u0430\u0435\u0442 \u0438\u0437-\u0437\u0430 \u0434\u0432\u0443\u0445 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u043f\u044b\u0442\u0430\u044e\u0449\u0438\u0445\u0441\u044f \u0432 \u0440\u0430\u0437\u043d\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043e\u0434\u043d\u0438 \u0438 \u0442\u0435 \u0436\u0435 \u0434\u0430\u043d\u043d\u044b\u0435. \u0415\u0441\u043b\u0438 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 \u0442\u0440\u0438\u0433\u0433\u0435\u0440\u044b, \u0442\u043e \u0432\u0430\u043c \u0432 \u043a\u043e\u0434\u0435 \u0434\u0430\u0436\u0435 \u043d\u0435 \u043d\u0430\u0434\u043e \u044f\u0432\u043d\u043e \u043e\u0431\u044a\u044f\u0432\u043b\u044f\u0442\u044c \u043e \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 - \u043b\u044e\u0431\u043e\u0439 UPDATE \u0441 \u0442\u0440\u0438\u0433\u0433\u0435\u0440\u043e\u043c \u043f\u043e\u0442\u0435\u043d\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u043e\u043f\u0430\u0441\u0435\u043d \u0434\u0435\u0434\u043b\u043e\u043a\u043e\u043c. \u041f\u0440\u0438 \u044d\u0442\u043e\u043c \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438\xa0",(0,r.jsx)(n.a,{href:"http://dev.mysql.com/doc/refman/5.7/en/innodb-deadlocks.html",children:"\u043d\u0435 \u0432\u043b\u0438\u044f\u0435\u0442"}),"\xa0\u043d\u0430 \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u044c \u0435\u0433\u043e \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f"]}),"\n",(0,r.jsx)(n.p,{children:"\u0414\u0435\u0442\u0430\u043b\u0438 \u0432 \u0431\u0430\u0437\u0435 \u043c\u043e\u0436\u043d\u043e \u0443\u0432\u0438\u0434\u0435\u0442\u044c \u0442\u0430\u043a:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SHOW ENGINE InnoDB STATUS;\n\n------------------------\nLATEST DETECTED DEADLOCK\n------------------------\n2016-10-21 08:21:41 0x7f772b726700\n*** (1) TRANSACTION:\nTRANSACTION 9651, ACTIVE 0 sec starting index read\nmysql tables in use 3, locked 3\nLOCK WAIT 4 lock struct(s), heap size 1136, 2 row lock(s), undo log entries 1\nMySQL thread id 1052, OS thread handle 140149807552256, query id 128292 localhost 127.0.0.1 tactic updating\nUPDATE folder c SET (...)\n\n*** (2) TRANSACTION:\nTRANSACTION 9650, ACTIVE 0 sec fetching rows\nmysql tables in use 3, locked 3\n8 lock struct(s), heap size 1136, 183 row lock(s), undo log entries 1\nMySQL thread id 1048, OS thread handle 140149806753536, query id 128291 localhost 127.0.0.1 tactic Sending data\nUPDATE folder c SET (...)\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u041e\u0431\u044b\u0447\u043d\u043e \u0441\u043e\u0432\u0435\u0442\u0443\u044e\u0442 \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u0434\u0435\u0434\u043b\u043e\u043a\u0430 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0442\u044c \u0432\u0441\u044e \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044e, \u043d\u043e \u044d\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0443\u0441\u043b\u043e\u0436\u043d\u0438\u0442\u044c \u0432\u0435\u0441\u044c \u043c\u0435\u0442\u043e\u0434.\xa0"}),"\n",(0,r.jsx)(n.p,{children:"\u0415\u0441\u043b\u0438 \u0432\u044b \u043d\u0435 \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0441\u043b\u043e\u0436\u043d\u044f\u0442\u044c \u0441\u0435\u0431\u0435 \u0436\u0438\u0437\u043d\u044c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u043e\u0439 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432, \u043c\u043e\u0436\u043d\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u043b\u043e\u043a \u043d\u0430 \u0432\u0435\u0441\u044c POST-\u0437\u0430\u043f\u0440\u043e\u0441, \u0441\u043a\u0430\u0436\u0435\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f memcache.\xa0"}),"\n",(0,r.jsx)(n.p,{children:"\u0422\u0430\u043a \u0438\u043b\u0438 \u0438\u043d\u0430\u0447\u0435, \u0432 \u0438\u0442\u043e\u0433\u0435 \u0432\u044b \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u0440\u043e\u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0447\u0442\u043e \u0434\u0432\u0430 \u0438\u043b\u0438 \u0431\u043e\u043b\u0435\u0435 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 REST-\u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043d\u0430 \u043e\u0434\u0438\u043d \u0438 \u0442\u043e\u0442 \u0436\u0435 URL \u043d\u0435 \u0443\u043f\u0430\u0434\u0443\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f PHPUnit. \u0412 php \u044d\u0442\u043e \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u0442\u0441\u044f \u043c\u0435\u0442\u043e\u0434\u043e\u043c curl_multi_init:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"function TwoConcurrentSaves_ShouldNotCauseError() {\n\t\t$urls       = [\n\t\t\t'http://kurapov.ee/file/save',\n\t\t\t'http://kurapov.ee/file/save',\n\t\t];\n\t\t$node_count = count($urls);\n\n\t\t$chs    = [];\n\t\t$master = curl_multi_init();\n\n\t\tfor ($i = 0; $i < $node_count; $i++) {\n\t\t\t$url = $urls[$i];\n\t\t\t$ch  = curl_init($url);\n\n\t\t\tcurl_setopt($ch, CURLOPT_POST, true);\n\t\t\tcurl_setopt($ch, CURLOPT_POSTFIELDS, ['collectionID' => 13, 'quality'=> 90]);\n\t\t\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n\t\t\tcurl_multi_add_handle($master, $ch);\n\t\t\t$chs[$i] = $ch;\n\t\t}\n\n\t\tdo {\n\t\t\tcurl_multi_exec($master, $running);\n\t\t} while ($running > 0);\n\n\t\tfor ($i = 0; $i < $node_count; $i++) {\n\t\t\t$response = curl_multi_getcontent($chs[$i]);\n\n\t\t\t$this->assertNotContains('Serialization failure', $response);\n\t\t\t$this->assertNotContains('Deadlock found', $response);\n\t\t}\n\t}\n"})})]})}function d(t={}){const{wrapper:n}={...(0,s.R)(),...t.components};return n?(0,r.jsx)(n,{...t,children:(0,r.jsx)(u,{...t})}):u(t)}},28453:(t,n,e)=>{e.d(n,{R:()=>i,x:()=>c});var r=e(96540);const s={},o=r.createContext(s);function i(t){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof t?t(n):{...n,...t}}),[n,t])}function c(t){let n;return n=t.disableParentContext?"function"==typeof t.components?t.components(s):t.components||s:i(t.components),r.createElement(o.Provider,{value:n},t.children)}}}]);